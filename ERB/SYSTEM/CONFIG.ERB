;コンフィグ画面とゲーム設定に関する処理

;-------------------------------------------------
;コンフィグの初期設定
;-------------------------------------------------
@INIT_CONFIG
CONFIG:3 = 50
CONFIG:4 = 30
CONFIG:6 = 1
CONFIG:9 = 1
CONFIG:80 = 2
CONFIG:15 = 1

;Enabling image system by default
CONFIG:555 = 1
CONFIG:556 = 1
CONFIG:557 = 1
CONFIG:600 = 1
;SLG部分のコンフィグの初期設定
CALL INIT_CONFIG_SLG
;デイリー部分のコンフィグの初期設定
CALL INIT_CONFIG_DAILY
;-------------------------------------------------
;コンフィグ画面の処理
;-------------------------------------------------
@SHOW_CONFIG
#DIM FIRST_LINE
FIRST_LINE = LINECOUNT
CALL SINGLE_DRAWLINE
PRINTL ★★進行各種設定和数據的操作★★
CALL SINGLE_DRAWLINE
PRINTBUTTON "  0[    関於ＳＬＧ部分的設定]", 0
PRINTL
PRINTBUTTON "  1[      関於交流部分的設定]", 1
PRINTL
PRINTBUTTON "  5[      関於特殊性癖的設定]", 5
PRINTL
PRINTBUTTON "  6[      関於日常事件的設定]", 6
PRINTL
PRINTBUTTON "  7[              口上過濾器]", 7
PRINTL
PRINTBUTTON "  8[          現有角色的保存]", 8
PRINTL
PRINTBUTTON " 10[              指令過濾器]", 10
PRINTL
PRINTL
PRINTBUTTON " 80[          保存現在的設定]", 80
PRINTL
PRINTBUTTON " 81[        読取保存過的設定]", 81
PRINTL
PRINTL
PRINTBUTTON " 82[          保存現在的設定(関於ＳＬＧ部分的設定除外)]", 82
PRINTL
PRINTBUTTON " 83[        読取保存過的設定(関於ＳＬＧ部分的設定除外)]", 83
PRINTL
PRINTBUTTON " 84[      日常事件設定的保存]", 84
PRINTL
PRINTBUTTON " 85[      日常事件設定的読取]", 85
PRINTL
CALL COLOR_LINE
PRINTBUTTON " 90[      幇助]", 90
PRINTL
IF FLAG:周回数 > 1
PRINTBUTTON " 89[      单独指导]", 89
PRINTL
ENDIF
PRINTBUTTON " 86[      DEBUG]", 9988
PRINTL
[IF_DEBUG]
PRINTBUTTON @" {GAMEBASE_VERSION}[      調試]", GAMEBASE_VERSION
PRINTL
[ENDIF]
;PRINTBUTTON " 85[データ操作]", 85
;PRINTL
CALL SINGLE_DRAWLINE
PRINTBUTTON " 99[      取消]", 99
PRINTL
$INPUT_LOOP
INPUT

IF RESULT == 99
	RETURN
ELSEIF RESULT == 0
	;→(SLG\CONFIG_SLG.ERB)
	CALL CONFIG_SLG
ELSEIF RESULT == 1
	CALL CONFIG_OTHERS
ELSEIF RESULT == 5
	;特殊設定
	CALL CONFIG_OTHERS_SP
ELSEIF RESULT == 6
	;イベント設定
	CALL CONFIG_EVENT_DAILY
ELSEIF RESULT == 7
	CALL CONFIG_KOJO_DAILY
ELSEIF RESULT == 8
	CALL CONFIG_SAVE_EXIST_CHARA
ELSEIF RESULT == 10
	CALL CONFIG_COM_FILTER
ELSEIF GROUPMATCH(RESULT, 80, 82)
	CALL CONFIG_SAVE(RESULT == 80)
ELSEIF GROUPMATCH(RESULT, 81, 83)
	CALL CONFIG_LOAD(RESULT == 81)
ELSEIF RESULT == 84
	CALL CONFIG_DAILY_SAVE()
ELSEIF RESULT == 85
	CALL CONFIG_DAILY_LOAD()
ELSEIF RESULT == 89
	CALL CONFIG_NOVICE_GUIDE
ELSEIF RESULT == 90
	CALL CONFIG_HELPMENU
ELSEIF RESULT == 9988
	CALL CONFIG_DATA_EDIT
	[IF_DEBUG]
ELSEIF RESULT == GAMEBASE_VERSION
	CALL CONFIG_DATA_EDIT
	[ENDIF]
ENDIF
CLEARLINE LINECOUNT - FIRST_LINE
RESTART

;-------------------------------------------------
;desc  :コンフィグの書き込み
;param :全て:全コンフィグを保存する（指定しない場合SLGを除く)
;-------------------------------------------------
@CONFIG_SAVE(全て)
#DIM 全て
#DIM 番号
CALL SINGLE_DRAWLINE
PRINTFORML 要保存在哪裡？
CALL SINGLE_DRAWLINE

CALL LISTUP_CONFIG

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_NAME"))
	GOTO INPUT_LOOP

番号 = RESULT

PRINTFORML 請輸入設定档案的名字
PRINTFORML (什麼都不輸入的話名字就是「設定{番号}」)

$INPUT_LOOP_2
INPUTS

IF RESULTS == ""
	G_CONFIG_NAME:番号 = 設定{番号}
ELSE
	G_CONFIG_NAME:番号 = %RESULTS%
ENDIF


SIF 全て
	CALL CONFIG_SAVE_SLG(番号)

CALL CONFIG_SAVE_EXCEPT_SLG(番号)

;-------------------------------------------------
;desc  :コンフィグの読み取り
;param :全て:全コンフィグを読む
;-------------------------------------------------
@CONFIG_LOAD(全て)
#DIM 全て
#DIM 番号
CALL SINGLE_DRAWLINE
PRINTFORML 要読取哪一個？
CALL SINGLE_DRAWLINE

CALL LISTUP_CONFIG

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_NAME")) || !CONFIG_EXISTS()
	GOTO INPUT_LOOP

番号 = RESULT

SIF 全て
	CALL CONFIG_LOAD_SLG(番号)

CALL CONFIG_LOAD_EXCEPT_SLG(番号)

;-------------------------------------------------
;desc  :コンフィグの書き込み
;param :全て:全コンフィグを保存する（指定しない場合SLGを除く)
;-------------------------------------------------
@CONFIG_DAILY_SAVE()
#DIM 番号
CALL SINGLE_DRAWLINE
PRINTFORML 要保存在哪裡？
CALL SINGLE_DRAWLINE

CALL LISTUP_CONFIG_DAILY

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_DAILY_NAME"))
	GOTO INPUT_LOOP

番号 = RESULT

PRINTFORML 請輸入設定档案的名字
PRINTFORML (什麼都不輸入的話名字就是「設定{番号}」)

$INPUT_LOOP_2
INPUTS

IF RESULTS == ""
	G_CONFIG_DAILY_NAME:番号 = 設定{番号}
ELSE
	G_CONFIG_DAILY_NAME:番号 = %RESULTS%
ENDIF


CALL CONFIG_SAVE_DAILY(番号)

;-------------------------------------------------
;desc  :コンフィグの読み取り
;param :全て:全コンフィグを読む
;-------------------------------------------------
@CONFIG_DAILY_LOAD()
#DIM 番号
CALL SINGLE_DRAWLINE
PRINTFORML 要読取哪一個？
CALL SINGLE_DRAWLINE

CALL LISTUP_CONFIG_DAILY

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_DAILY_NAME")) || !CONFIG_DAILY_EXISTS()
	GOTO INPUT_LOOP

番号 = RESULT

CALL CONFIG_LOAD_DAILY(番号)


;-------------------------------------------------
;desc  :コンフィグをリストアップして印字する
;-------------------------------------------------
@LISTUP_CONFIG()
FOR LOCAL, 0, VARSIZE("G_CONFIG_NAME")
	PRINTBUTTON @"[{LOCAL}] 設定{LOCAL} - %G_CONFIG_NAME:LOCAL%", LOCAL
	PRINTL
NEXT

;-------------------------------------------------
;desc  :コンフィグをリストアップして印字する
;-------------------------------------------------
@LISTUP_CONFIG_FILTER()
FOR LOCAL, 0, VARSIZE("G_CONFIG_FILTER_NAME")
	PRINTBUTTON @"[{LOCAL}] 設定{LOCAL} - %G_CONFIG_FILTER_NAME:LOCAL%", LOCAL
	PRINTL
NEXT

;-------------------------------------------------
;desc  :コンフィグをリストアップして印字する
;-------------------------------------------------
@LISTUP_CONFIG_DAILY()
FOR LOCAL, 0, VARSIZE("G_CONFIG_DAILY_NAME")
	PRINTBUTTON @"[{LOCAL}] 設定{LOCAL} - %G_CONFIG_DAILY_NAME:LOCAL%", LOCAL
	PRINTL
NEXT


;-------------------------------------------------
;desc  :指定番号のコンフィグが存在するか返す
;param :番号:コンフィグ配列のインデックス
;return:1か0:存在するかどうか
;-------------------------------------------------
@CONFIG_EXISTS(番号)
#FUNCTION
#DIM 番号
RETURNF G_CONFIG_NAME:番号 != ""

;-------------------------------------------------
;desc  :指定番号のコンフィグが存在するか返す
;param :番号:コンフィグ配列のインデックス
;return:1か0:存在するかどうか
;-------------------------------------------------
@CONFIG_DAILY_EXISTS(番号)
#FUNCTION
#DIM 番号
RETURNF G_CONFIG_DAILY_NAME:番号 != ""


;-------------------------------------------------
;その他の部分に関する設定
;-------------------------------------------------
@CONFIG_OTHERS
#DIM FIRST_LINE
FIRST_LINE = LINECOUNT
CALL SINGLE_DRAWLINE
PRINTL ●関於交流部分的設定●
CALL SINGLE_DRAWLINE

LOCALS:0 = 妊娠的有無
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  1[変更]", 1
PRINT
SELECTCASE CONFIG:1
	CASE 0
		PRINT 可以妊娠
	CASE 1
		PRINT 不能妊娠
ENDSELECT
PRINTL


LOCALS:0 = 随机角色的男性比率
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  3[変更]", 3
PRINT
PRINTFORM {CONFIG:3}\%
PRINTL

LOCALS:0 = 孩子的男性比率
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  4[変更]", 4
PRINT
PRINTFORM {CONFIG:4}\%
PRINTL


LOCALS:0 = 捕虜的処理的設定
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  7[変更]", 7
PRINT
SELECTCASE CONFIG:7
	CASE 0
		PRINT 拠点階段終了時選択
	CASE 1
		PRINT 在拠点階段的菜単内選択
ENDSELECT
PRINTL

LOCALS:0 = 対男主人公被逆向調教的傾向
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  8[変更]", 8
PRINT
SELECTCASE CONFIG:8
	CASE 0
		PRINT 榨取精液
	CASE 1
		PRINT 射精管理
ENDSELECT
PRINTL

LOCALS:0 = 潮吹的有無
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "  9[変更]", 9
PRINT
SELECTCASE CONFIG:9
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

LOCALS:0 = 避孕套自動装着＆補給
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 10[変更]", 10
PRINT
SELECTCASE CONFIG:10
	CASE 0
		PRINT 無
	CASE 1
		PRINT 有効（主人公以外）
	CASE 2
		PRINT 全員
ENDSELECT
PRINTL

LOCALS:0 = 「慰安民衆」的民衆的性別
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 14[変更]", 14
PRINT
SELECTCASE CONFIG:14
	CASE 0
		PRINT 随机
	CASE 1
		PRINT 只有男性（部分無効）
	CASE 2
		PRINT 只有女性（部分無効）
	CASE 3
		PRINT 只有扶她（部分無効）
ENDSELECT
PRINTL

LOCALS:0 = 「慰安民衆」是否存在在野武将
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 15[変更]", 15
PRINT
SELECTCASE CONFIG:15
	CASE 0
		PRINT 存在
	CASE 1
		PRINT 不存在
ENDSELECT
PRINTL

LOCALS:0 = 如何対待出生的子女
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "16[変更]", 16
PRINT
SELECTCASE CONFIG:16
	CASE 0
		PRINT 単独選択
	CASE 1
		PRINT 自動登用
	CASE 2
		PRINT 自動不登用
ENDSELECT
PRINTL

;
;LOCALS:0 = 陰毛状態の表示
;PRINTFORM %LOCALS:0, 30, RIGHT% -
;PRINTBUTTON "15[変更]", 15
;PRINT
;SELECTCASE CONFIG:15
;	CASE 0
;		PRINT 表示する
;		COM_FILTER:113 = 0
;	CASE 2
;		PRINT 表示しない
;	CASE 1
;		PRINT コマンドも表示しない
;		COM_FILTER:113 = 1
;ENDSELECT
;PRINTL
;
;LOCALS:0 = タトゥの表示
;PRINTFORM %LOCALS:0, 30, RIGHT% -
;PRINTBUTTON "16[変更]", 16
;PRINT
;SELECTCASE CONFIG:16
;	CASE 0
;		PRINT 表示する
;		COM_FILTER:92 = 0
;	CASE 2
;		PRINT 表示しない
;	CASE 1
;		PRINT コマンドも表示しない
;		COM_FILTER:92 = 1
;ENDSELECT
;PRINTL
;
LOCALS:0 = 逆調教被俘主人公時的参加者
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 17[変更]", 17
PRINT
SELECTCASE CONFIG:17
	CASE 0
		PRINT 全員許可
	CASE 1
		PRINT 只允許認識的人
ENDSELECT
PRINTL

LOCALS:0 = 东方角色的口上表示
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 40[変更]", 40
PRINT
SELECTCASE CONFIG:40
	CASE 0
		PRINT 顯示
	CASE 1
		PRINT 不顯示
ENDSELECT
PRINTL

LOCALS:0 = 通用角色的口上表示
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 41[変更]", 41
PRINT
SELECTCASE CONFIG:41
	CASE 0
		PRINT 顯示
	CASE 1
		PRINT 不顯示
ENDSELECT
PRINTL

LOCALS:0 = 調教終了後性癖等級自動上昇
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON " 42[変更]", 42
PRINT
SELECTCASE CONFIG:42
	CASE 0
		PRINT 関閉
	CASE 1
		PRINT 開啟
ENDSELECT
PRINTL
LOCALS:0 = 图像系统
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "555[变更]", 555
PRINT
SELECTCASE CONFIG:555
	CASE 0
		PRINT 関閉
	CASE 1
		PRINT 開啟
ENDSELECT
PRINTL

LOCALS:0 = 受精图像/动画
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "555[变更]", 557
PRINT
SELECTCASE CONFIG:557
	CASE 0
		PRINT 関閉
	CASE 1
		PRINT 開啟
ENDSELECT
PRINTL


LOCALS:0 = 建筑SLG信息
PRINTFORM %LOCALS:0, 30, RIGHT% -
PRINTBUTTON "600[变更]", 600
PRINT
SELECTCASE CONFIG:600
	CASE 0
		PRINT 不显示
	CASE 1
		PRINT 显示与玩家相关的
	CASE 2
		PRINT 显示所有建筑信息
ENDSELECT
PRINTL
CALL SINGLE_DRAWLINE
PRINTBUTTON " 99[決定]", 99
PRINTL

$INPUT_LOOP
INPUT

IF RESULT == 99
	RETURN
ELSEIF RESULT == 0
	CALL CONFIG_TOGGLE(0)
ELSEIF RESULT == 1
	CALL CONFIG_TOGGLE(1)
ELSEIF RESULT == 2 && CONFIG:1 == 0
	CALL CONFIG_TOGGLE(2)
ELSEIF RESULT == 3
	CONFIG:3 += 10
	IF CONFIG:3 > 100
		CONFIG:3 = 0
	ENDIF
ELSEIF RESULT == 4
	CONFIG:4 += 10
	IF CONFIG:4 > 100
		CONFIG:4 = 0
	ENDIF
ELSEIF RESULT == 7
	CALL CONFIG_TOGGLE(7)
ELSEIF RESULT == 8
	CALL CONFIG_TOGGLE(8)
ELSEIF RESULT == 9
	CALL CONFIG_TOGGLE(9)
ELSEIF RESULT == 10
	CONFIG:10 = ROUND_INCREMENT(CONFIG:10, 0, 2)
ELSEIF RESULT == 14
	CONFIG:14 = ROUND_INCREMENT(CONFIG:14, 0, 3)
ELSEIF RESULT == 15
	CALL CONFIG_TOGGLE(15)
ELSEIF RESULT == 16
	CONFIG:16 = ROUND_INCREMENT(CONFIG:16, 0, 2)
ELSEIF RESULT == 17
	SELECTCASE CONFIG:17
		CASE 0
			CONFIG:17 = 1
		CASE 1
			CONFIG:17 = 0
	ENDSELECT
ELSEIF RESULT == 18
	CALL CONFIG_TOGGLE(18)
ELSEIF RESULT == 40
	CALL CONFIG_TOGGLE(40)
ELSEIF RESULT == 41
	CALL CONFIG_TOGGLE(41)
ELSEIF RESULT == 42
	CALL CONFIG_TOGGLE(42)
ELSEIF RESULT == 555
	CALL CONFIG_TOGGLE(555)
ELSEIF RESULT == 557
	CALL CONFIG_TOGGLE(557)
ELSEIF RESULT == 600
	CONFIG:600 = ROUND_INCREMENT(CONFIG:600, 0, 2)
ELSE
	GOTO INPUT_LOOP
ENDIF
CLEARLINE LINECOUNT - FIRST_LINE
RESTART

;-------------------------------------------------
;特殊設定(主に好き嫌いが分かれやすい要素の設定)
;-------------------------------------------------
@CONFIG_OTHERS_SP
#DIM L_COUNTER
#DIM FIRST_LINE
#DIM CONST COM_AUTO_ADD_INPUT_NUM = 300	;おまかせ系の入力値に加算する値
#DIM COM_AUTO_INPUT_RESULT_NUM			;おまかせ系の入力値に加算する値を減算した値

FIRST_LINE = LINECOUNT
CALL SINGLE_DRAWLINE
PRINTL ●特殊設定●
CALL SINGLE_DRAWLINE
PRINTL ◇特殊勢力◇

LOCALS:0 = 特殊勢力対俘虜的調教1
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{80, 4}[変更]", 80
PRINT
SELECTCASE CONFIG:80
	CASE 0
		PRINT 不会発生
	CASE 1
		PRINT 只有女性・女扶她発生
	CASE 2
		PRINT 全部発生
ENDSELECT
PRINTL

LOCALS:0 = 特殊勢力対俘虜的調教2
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{81, 4}[変更]", 81
PRINT
SELECTCASE CONFIG:81
	CASE 0
		PRINT 全特殊勢力
	CASE 1
		PRINT 只有自己所属的特殊勢力
	CASE 2
		PRINT 自己所属以外的特殊勢力
ENDSELECT
PRINTL

LOCALS:0 = 特殊勢力対俘虜的調教3
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{82, 4}[変更]", 82
PRINT
SELECTCASE CONFIG:82
	CASE 0
		PRINT 全部
	CASE 1
		PRINT 只有俘虜（排除士官）
	CASE 2
		PRINT 只有那勢力的士官（排除俘虜）
ENDSELECT
PRINTL

CALL COLOR_LINE
PRINTL ◇排洩系◇
LOCALS:0 = 高潮時尿意到達限界時
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{90, 4}[変更]", 90
PRINT
SELECTCASE CONFIG:90
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

LOCALS:0 = 恐怖的異常上昇時
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{91, 4}[変更]", 91
PRINT
SELECTCASE CONFIG:91
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

LOCALS:0 = 日常事件带来的排泄経験値的上昇
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{92, 4}[変更]", 92
PRINT
SELECTCASE CONFIG:92
	CASE 0
		PRINT 許可
	CASE 1
		PRINT 禁止
ENDSELECT
PRINTL

CALL COLOR_LINE
PRINTL ◇全般◇


LOCALS:0 = 男同的指令過濾（部分）
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{201, 3}[変更]", 201
PRINT
SELECTCASE CONFIG:201
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

;修改↓
LOCALS:0 = 探索事件的百合化
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{202, 3}[変更]", 202
PRINT
SELECTCASE CONFIG:202
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL
;修改↑

LOCALS:0 = 部分事件痴女化
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON @"{203, 3}[変更]", 203
PRINT
SELECTCASE CONFIG:203
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

LOCALS:0 = 在调教过程中显示主人公的反应
PRINTFORM %LOCALS:0, 50, RIGHT% -
PRINTBUTTON "441[変更]", 441
PRINT
SELECTCASE CONFIG:441
	CASE 0
		PRINT 無効
	CASE 1
		PRINT 有効
ENDSELECT
PRINTL

CALL COLOR_LINE
PRINTL ◇受人擺佈時の行動◇
FOR L_COUNTER, 1, COM_AUTO_FILTER_MAX + 1
	SIF COM_AUTO_FILTER_NAME(L_COUNTER) == ""
		CONTINUE
	LOCALS:0 = %COM_AUTO_FILTER_NAME(L_COUNTER)%
	PRINTFORM %LOCALS:0, 50, RIGHT% -
	PRINTBUTTON @"{L_COUNTER + COM_AUTO_ADD_INPUT_NUM, 4}[変更]", L_COUNTER + COM_AUTO_ADD_INPUT_NUM
	PRINT
	SELECTCASE GETBIT(CONFIG:11, L_COUNTER)
		CASE 0
			PRINT 無効
		CASE 1
			PRINT 有効
	ENDSELECT
	PRINTL
NEXT

CALL SINGLE_DRAWLINE
PRINTL [99] 決定

$INPUT_LOOP
INPUT

IF RESULT == 99
	RETURN
ELSEIF RESULT == 70
	CONFIG:70 ++
	IF CONFIG:70 >= 2
		CONFIG:70 = 0
	ENDIF
ELSEIF RESULT == 71
	CONFIG:71 ++
	IF CONFIG:71 >= 3
		CONFIG:71 = 0
	ENDIF
ELSEIF RESULT == 79 && CONFIG:71 == 2
	CONFIG:79 ++
	IF CONFIG:79 >= 3
		CONFIG:79 = 0
	ENDIF
ELSEIF RESULT == 72 && (CONFIG:70 || CONFIG:71)
	CONFIG:72 ++
	IF CONFIG:72 >= 2
		CONFIG:72 = 0
	ENDIF
ELSEIF RESULT == 73 && (CONFIG:70 || CONFIG:71)
	CONFIG:73 ++
	IF CONFIG:73 >= 2
		CONFIG:73 = 0
	ENDIF
ELSEIF RESULT == 77 && (CONFIG:70 || CONFIG:71) && CONFIG:73 == 1
	CONFIG:77 ++
	IF CONFIG:77 >= 6
		CONFIG:77 = 0
	ENDIF
ELSEIF RESULT == 78 && (CONFIG:70 || CONFIG:71) && CONFIG:73 == 1
	CONFIG:78 ++
	IF CONFIG:78 >= 2
		CONFIG:78 = 0
	ENDIF
ELSEIF RESULT == 74 && (CONFIG:70 || CONFIG:71)
	CONFIG:74 ++
	IF CONFIG:74 >= 2
		CONFIG:74 = 0
	ENDIF
ELSEIF RESULT == 75 && (CONFIG:70 || CONFIG:71)
	CONFIG:75 ++
	IF CONFIG:75 >= 2
		CONFIG:75 = 0
	ENDIF
ELSEIF RESULT == 76 && (CONFIG:70 || CONFIG:71) && CONFIG:1 == 0
	CONFIG:76 ++
	IF CONFIG:76 >= 2
		CONFIG:76 = 0
	ENDIF
ELSEIF RESULT == 80
	CONFIG:80 ++
	IF CONFIG:80 >= 3
		CONFIG:80 = 0
	ENDIF
ELSEIF RESULT == 81
	CONFIG:81 ++
	IF CONFIG:81 >= 3
		CONFIG:81 = 0
	ENDIF
ELSEIF RESULT == 82
	CONFIG:82 ++
	IF CONFIG:82 >= 3
		CONFIG:82 = 0
	ENDIF
ELSEIF RESULT == 83
	CONFIG:83 ++
	IF CONFIG:83 >= 3
		CONFIG:83 = 0
	ENDIF
ELSEIF RESULT == 84
	CONFIG:84 ++
	IF CONFIG:84 >= 3
		CONFIG:84 = 0
	ENDIF
ELSEIF RESULT == 85
	CONFIG:85 ++
	IF CONFIG:85 >= 2
		CONFIG:85 = 0
	ENDIF
ELSEIF RESULT == 86
	CONFIG:86 ++
	IF CONFIG:86 >= 3
		CONFIG:86 = 0
	ENDIF
ELSEIF RESULT == 87
	CONFIG:87 ++
	IF CONFIG:87 >= 2
		CONFIG:87 = 0
	ENDIF
ELSEIF RESULT == 90
	CONFIG:90 ++
	IF CONFIG:90 >= 2
		CONFIG:90 = 0
	ENDIF
ELSEIF RESULT == 91
	CONFIG:91 ++
	IF CONFIG:91 >= 2
		CONFIG:91 = 0
	ENDIF
ELSEIF RESULT == 92
	CONFIG:92 ++
	IF CONFIG:92 >= 2
		CONFIG:92 = 0
	ENDIF

ELSEIF RESULT == 201
	CONFIG:201 = !CONFIG:201
ELSEIF RESULT == 441
	CALL CONFIG_TOGGLE(441)

;修改↓
ELSEIF RESULT == 202
	CONFIG:202 = !CONFIG:202
;修改↑

ELSEIF RESULT == 203
	CONFIG:203 = !CONFIG:203

;おまかせの設定
ELSEIF RESULT >= 1 + COM_AUTO_ADD_INPUT_NUM && RESULT <= COM_AUTO_FILTER_MAX + COM_AUTO_ADD_INPUT_NUM
	COM_AUTO_INPUT_RESULT_NUM = RESULT - COM_AUTO_ADD_INPUT_NUM
	IF GETBIT(CONFIG:11, COM_AUTO_INPUT_RESULT_NUM)
		CLEARBIT CONFIG:11, COM_AUTO_INPUT_RESULT_NUM
	ELSE
		SETBIT CONFIG:11, COM_AUTO_INPUT_RESULT_NUM
	ENDIF
ELSE
	GOTO INPUT_LOOP
ENDIF
CLEARLINE LINECOUNT - FIRST_LINE
RESTART

;-------------------------------------------------
;既存のキャラをカスタムキャラとして保存する
;-------------------------------------------------
@CONFIG_SAVE_EXIST_CHARA()
#DIM FIRST_LINE, 2
#DIM 対象
#DIM ページ
FIRST_LINE:0 = LINECOUNT
CALL SINGLE_DRAWLINE
PRINTFORML 把現有的角色保存為定制角色所留下
PRINTFORML (血縁関係等、部分設定會被刪除)
CALL SINGLE_DRAWLINE
CALL SELECT_CHARA_LIST_ONLY_LOGIC_SLG("NONE", "NONE")

IF RESULT == -1
	RETURN 0
ENDIF

対象 = RESULT

FIRST_LINE:1 = LINECOUNT

$LISTUP_LOOP

CALL LISTUP_CUSTOM_CHARACTER(0, ページ, 20)
CALL SINGLE_DRAWLINE
PRINTBUTTON "[取消]", 10000

INPUT

IF RESULT == 10000
	CLEARLINE LINECOUNT - FIRST_LINE
	RESTART
ELSEIF RESULT == MAX_CUSTOM_CHARA
	ページ = ROUND_DECREMENT(ページ, 0, MAX_CUSTOM_CHARA / 20)
ELSEIF RESULT == MAX_CUSTOM_CHARA + 1
	ページ = ROUND_INCREMENT(ページ, 0, MAX_CUSTOM_CHARA / 20)
ELSEIF INRANGE(RESULT, 0, MAX_CUSTOM_CHARA)
	LOCAL = RESULT
	IF FIND_CHARADATA(TOSTR(LOCAL))
		PRINTFORML {LOCAL}號位置已經存在了定制角色
		PRINTFORML 要覆蓋麼？
		CALL ASK_YN()
		IF RESULT == 1
			CLEARLINE LINECOUNT - FIRST_LINE:1
			GOTO LISTUP_LOOP
		ENDIF
	ENDIF
	CALL SAVE_CUSTOM_DATA(LOCAL, 対象)
	PRINTFORML 保存完畢
	CLEARLINE LINECOUNT - FIRST_LINE
	RESTART
ENDIF

CLEARLINE LINECOUNT - FIRST_LINE:1
GOTO LISTUP_LOOP

;-------------------------------------------------
;コマンドフィルタ
;-------------------------------------------------
@CONFIG_COM_FILTER
#DIM FIRST_LINE
#DIM 有効コマンド数
#DIM ページ数
#DIM 現在ページ
#DIM 始点
#DIM 終点
#DIM ページ内表示数
#DIM 改行カウンタ

;ページ数の計算
有効コマンド数 = 0
FOR LOCAL:0, 0, 1000
	IF TRAINNAME:(LOCAL:0) != ""
		有効コマンド数 ++
	ENDIF
NEXT
ページ数 = (有効コマンド数 - 1) / 66 + 1
現在ページ = 1

CALL SINGLE_DRAWLINE
PRINTFORML 绿色的命令因为系统的原因是不能过滤的。
CALL SINGLE_DRAWLINE
FIRST_LINE = LINECOUNT
$SHOW_LOOP

;コマンドの表示
有効コマンド数 = 0
始点 = (現在ページ - 1) * 88
終点 = 現在ページ * 88
改行カウンタ = 0
FOR LOCAL:0, 0, 1000
	IF TRAINNAME:(LOCAL:0) != ""
		IF 有効コマンド数 >= 始点 && 有効コマンド数 < 終点
			IF 改行カウンタ >= 1 && 改行カウンタ % 4 == 0
				PRINTL
			ENDIF
			RESULT = 0
			TRYCALLFORM COM_FILTER_FORCE_OFF{LOCAL:0}
			IF RESULT
				SETCOLOR カラー_パ緑
				PRINTPLAINFORM [{LOCAL:0, 3}] %TRAINNAME:(LOCAL:0), 21, LEFT%
			ELSE
				IF COM_FILTER:(LOCAL:0)
					SETCOLOR カラー_選択不可
				ENDIF
				PRINTFORM [{LOCAL:0, 3}] %TRAINNAME:(LOCAL:0), 21, LEFT%
			ENDIF
			RESETCOLOR
			改行カウンタ ++
		ENDIF
		有効コマンド数 ++
	ENDIF
NEXT
PRINTL
CALL SINGLE_DRAWLINE

PRINT [990] 察看前一頁
PRINTPLAINFORM page{現在ページ}/{ページ数}
PRINTL [991] 察看下一頁


CALL SINGLE_DRAWLINE
PRINTL [997] 保存
PRINTL [998] 载入
PRINTL [999] 決定

REDRAW 0

$INPUT_LOOP
INPUT

IF RESULT == 999
	REDRAW 1
	RETURN
ELSEIF RESULT == 997
	CALL CONFIG_COM_FILTER_SAVE()
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ELSEIF RESULT == 998
	CALL CONFIG_COM_FILTER_LOAD()
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ELSEIF RESULT == 990
	現在ページ --
	IF 現在ページ < 1
		現在ページ = ページ数
	ENDIF
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ELSEIF RESULT == 991
	現在ページ ++
	IF 現在ページ > ページ数
		現在ページ = 1
	ENDIF
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO SHOW_LOOP
ELSEIF RESULT >= 0 && RESULT < 1000
	LOCAL:5 = RESULT
	IF TRAINNAME:(LOCAL:5) != ""
		RESULT = 0
		TRYCALLFORM COM_FILTER_FORCE_OFF{LOCAL:5}
		IF !RESULT
			COM_FILTER:(LOCAL:5) = !COM_FILTER:(LOCAL:5)
			CLEARLINE LINECOUNT - FIRST_LINE
			GOTO SHOW_LOOP
		ENDIF
	ENDIF
ENDIF
CLEARLINE 1
GOTO INPUT_LOOP

;-------------------------------------------------
;DESC  :コマンドフィルタのセーブ
;ARG   ::
;-------------------------------------------------
@CONFIG_COM_FILTER_SAVE()
#DIM 番号

CALL SINGLE_DRAWLINE
PRINTFORML 要保存在哪裡？
CALL SINGLE_DRAWLINE

CALL LISTUP_CONFIG_FILTER

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_NAME"))
	GOTO INPUT_LOOP

番号 = RESULT

PRINTFORML 請輸入設定档案的名字
PRINTFORML (什麼都不輸入的話名字就是「設定{番号}」)

$INPUT_LOOP_2
INPUTS

IF RESULTS == ""
	G_CONFIG_FILTER_NAME:番号 = 設定{番号}
ELSE
	G_CONFIG_FILTER_NAME:番号 = %RESULTS%
ENDIF

FOR LOCAL, 0, VARSIZE("COM_FILTER")
	G_FILTER:番号:(LOCAL:0) = COM_FILTER:(LOCAL:0)
NEXT

;グローバル変数を保存
SAVEGLOBAL
RETURN


;-------------------------------------------------
;desc  :コンフィグの読み取り
;-------------------------------------------------
@CONFIG_COM_FILTER_LOAD()
#DIM 番号
CALL SINGLE_DRAWLINE
PRINTFORML 要読取哪一個？
CALL SINGLE_DRAWLINE

FOR LOCAL, 0, VARSIZE("G_CONFIG_FILTER_NAME")
	PRINTBUTTON @"[{LOCAL}] 設定{LOCAL} - %G_CONFIG_FILTER_NAME:LOCAL%", LOCAL
	PRINTL
NEXT

PRINTFORML [99] 取消

$INPUT_LOOP
INPUT

SIF RESULT == 99
	RETURN

SIF !INRANGE(RESULT, 0, VARSIZE("G_CONFIG_FILTER_NAME")) || G_CONFIG_FILTER_NAME:RESULT == ""
	GOTO INPUT_LOOP

番号 = RESULT

FOR LOCAL, 0, VARSIZE("COM_FILTER")
	COM_FILTER:(LOCAL:0) = G_FILTER:番号:(LOCAL:0)
NEXT



;-------------------------------------------------
;0か1だけのCONFIG切り替え
;-------------------------------------------------
@CONFIG_TOGGLE(ARG)
CONFIG:ARG ++
CONFIG:ARG &= 0x1
RETURN 0
