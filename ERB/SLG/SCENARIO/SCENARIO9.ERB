;-------------------------------------------------
;シナリオ9
;-------------------------------------------------
@SCENARIO_NAME_9
RESULTS = 幻想郷大戦・異
RETURN

@SCENARIO_INTRO_9
PRINTFORML
PRINTFORMW 有点点不一樣的幻想鄉
PRINTFORMW 你要和誰結伴、和誰戦闘？
PRINTL

;ランダムキャラは選択に委ねる
FLAG:OPランダムキャラ使用 = 0

@SCENARIO_PLACEMENT_9

;勢力設定
COUNTRY_BOSS:0 = 0
COUNTRY_COLOR:0 = GETDEFCOLOR()



;--------霊夢--------
COUNTRY_BOSS:1 = GET_ID(NAME_TO_CHARA("霊夢"))
COUNTRY_COLOR:1 = 0xFF0000
COUNTRY_AI_TYPE:1 = AI_外交

CITY_OWNER:GET_CITYNUMBER("博麗神社") = 1
CITY_OWNER:GET_CITYNUMBER("水楢之林") = 1
CITY_OWNER:GET_CITYNUMBER("人里住宅街") = 1
CITY_OWNER:GET_CITYNUMBER("阿求屋敷") = 1
CITY_OWNER:GET_CITYNUMBER("鈴奈庵") = 1

CFLAG:(NAME_TO_CHARA("霊夢")):1 = 1
CFLAG:(NAME_TO_CHARA("咲夜")):1 = 1
CFLAG:(NAME_TO_CHARA("レミリア")):1 = 1
CFLAG:(NAME_TO_CHARA("文")):1 = 1
CFLAG:(NAME_TO_CHARA("阿求")):1 = 1
CFLAG:(NAME_TO_CHARA("天子")):1 = 1
CFLAG:(NAME_TO_CHARA("小鈴")):1 = 1
CFLAG:(NAME_TO_CHARA("針妙丸")):1 = 1

;--------魔理沙--------
COUNTRY_BOSS:2 = GET_ID(NAME_TO_CHARA("魔理沙"))
COUNTRY_COLOR:2 = 0x79FF4B
COUNTRY_AI_TYPE:2 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("玛格特洛依德邸") = 2
CITY_OWNER:GET_CITYNUMBER("霧雨魔法店") = 2
CITY_OWNER:GET_CITYNUMBER("地下図書館") = 2
CITY_OWNER:GET_CITYNUMBER("紅魔館") = 2

CFLAG:(NAME_TO_CHARA("魔理沙")):1 = 2
CFLAG:(NAME_TO_CHARA("小悪魔")):1 = 2
CFLAG:(NAME_TO_CHARA("パチュリー")):1 = 2
CFLAG:(NAME_TO_CHARA("フランドール")):1 = 2
CFLAG:(NAME_TO_CHARA("アリス")):1 = 2
CFLAG:(NAME_TO_CHARA("にとり")):1 = 2
CFLAG:(NAME_TO_CHARA("上海人形")):1 = 2
CFLAG:(NAME_TO_CHARA("蓬莱人形")):1 = 2

;--------華扇--------
COUNTRY_BOSS:3 = GET_ID(NAME_TO_CHARA("華扇"))
COUNTRY_COLOR:3 = 0xF5A9F2
COUNTRY_AI_TYPE:3 = AI_内政

CITY_OWNER:GET_CITYNUMBER("八雲屋敷") = 3
CITY_OWNER:GET_CITYNUMBER("迷途之家") = 3
CITY_OWNER:GET_CITYNUMBER("旧地獄街道") = 3
CITY_OWNER:GET_CITYNUMBER("旧都温泉街") = 3
CITY_OWNER:GET_CITYNUMBER("旧都歓楽街") = 3

CFLAG:(NAME_TO_CHARA("橙")):1 = 3
CFLAG:(NAME_TO_CHARA("藍")):1 = 3
CFLAG:(NAME_TO_CHARA("紫")):1 = 3
CFLAG:(NAME_TO_CHARA("萃香")):1 = 3
CFLAG:(NAME_TO_CHARA("勇儀")):1 = 3
CFLAG:(NAME_TO_CHARA("華扇")):1 = 3
CFLAG:(NAME_TO_CHARA("芳香")):1 = 3
CFLAG:(NAME_TO_CHARA("青娥")):1 = 3

;--------お空--------
COUNTRY_BOSS:4 = GET_ID(NAME_TO_CHARA("空"))
COUNTRY_COLOR:4 = 0x002FFF
COUNTRY_AI_TYPE:4 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("地霊殿") = 4
CITY_OWNER:GET_CITYNUMBER("灼熱地獄跡") = 4
CITY_OWNER:GET_CITYNUMBER("間歇泉地下中心") = 4
CITY_OWNER:GET_CITYNUMBER("守矢神社") = 4
CITY_OWNER:GET_CITYNUMBER("風神之湖") = 4

CFLAG:(NAME_TO_CHARA("早苗")):1 = 4
CFLAG:(NAME_TO_CHARA("神奈子")):1 = 4
CFLAG:(NAME_TO_CHARA("諏訪子")):1 = 4
CFLAG:(NAME_TO_CHARA("さとり")):1 = 4
CFLAG:(NAME_TO_CHARA("燐")):1 = 4
CFLAG:(NAME_TO_CHARA("空")):1 = 4

;--------こころ--------
COUNTRY_BOSS:5 = GET_ID(NAME_TO_CHARA("こころ"))
COUNTRY_COLOR:5 = 0xFA5882
COUNTRY_AI_TYPE:5 = AI_外交

CITY_OWNER:GET_CITYNUMBER("夢殿大祀廟") = 5
CITY_OWNER:GET_CITYNUMBER("神霊廟") = 5

CFLAG:(NAME_TO_CHARA("こいし")):1 = 5
CFLAG:(NAME_TO_CHARA("一輪")):1 = 5
CFLAG:(NAME_TO_CHARA("雲山")):1 = 5
CFLAG:(NAME_TO_CHARA("白蓮")):1 = 5
CFLAG:(NAME_TO_CHARA("布都")):1 = 5
CFLAG:(NAME_TO_CHARA("屠自古")):1 = 5
CFLAG:(NAME_TO_CHARA("神子")):1 = 5
CFLAG:(NAME_TO_CHARA("こころ")):1 = 5

;--------星--------
COUNTRY_BOSS:6 = GET_ID(NAME_TO_CHARA("星"))
COUNTRY_COLOR:6 = 0XFACC2E
COUNTRY_AI_TYPE:6 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("命蓮寺") = 6
CITY_OWNER:GET_CITYNUMBER("墓地") = 6
CITY_OWNER:GET_CITYNUMBER("無縁塚") = 6

CFLAG:(NAME_TO_CHARA("ナズーリン")):1 = 6
CFLAG:(NAME_TO_CHARA("小傘")):1 = 6
CFLAG:(NAME_TO_CHARA("水蜜")):1 = 6
CFLAG:(NAME_TO_CHARA("星")):1 = 6
CFLAG:(NAME_TO_CHARA("ぬえ")):1 = 6
CFLAG:(NAME_TO_CHARA("響子")):1 = 6
CFLAG:(NAME_TO_CHARA("マミゾウ")):1 = 6

;--------クラピー--------
COUNTRY_BOSS:7 = GET_ID(NAME_TO_CHARA("クラウンピース"))
COUNTRY_COLOR:7 = 0x00BFFF
COUNTRY_AI_TYPE:7 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("霧之湖的湖畔") = 7
CITY_OWNER:GET_CITYNUMBER("霧之湖") = 7
CITY_OWNER:GET_CITYNUMBER("表之月面") = 7
CITY_OWNER:GET_CITYNUMBER("静寂海") = 7

CFLAG:(NAME_TO_CHARA("クラウンピース")):1 = 7
CFLAG:(NAME_TO_CHARA("大妖精")):1 = 7
CFLAG:(NAME_TO_CHARA("チルノ")):1 = 7
CFLAG:(NAME_TO_CHARA("リリーホワイト")):1 = 7
CFLAG:(NAME_TO_CHARA("リリーブラック")):1 = 7
CFLAG:(NAME_TO_CHARA("サニーミルク")):1 = 7
CFLAG:(NAME_TO_CHARA("ルナチャイルド")):1 = 7
CFLAG:(NAME_TO_CHARA("スターサファイア")):1 = 7
CFLAG:(NAME_TO_CHARA("純狐")):1 = 7

;--------妹紅--------
COUNTRY_BOSS:8 = GET_ID(NAME_TO_CHARA("妹紅"))
COUNTRY_COLOR:8 = 0x974E00
COUNTRY_AI_TYPE:8 = AI_内政

CITY_OWNER:GET_CITYNUMBER("妹紅宅") = 8
CITY_OWNER:GET_CITYNUMBER("寺子屋") = 8
CITY_OWNER:GET_CITYNUMBER("八目鰻小店") = 8
CITY_OWNER:GET_CITYNUMBER("迷途竹林東部") = 8
CITY_OWNER:GET_CITYNUMBER("永遠亭") = 8

CFLAG:(NAME_TO_CHARA("ミスティア")):1 = 8
CFLAG:(NAME_TO_CHARA("慧音")):1 = 8
CFLAG:(NAME_TO_CHARA("永琳")):1 = 8
CFLAG:(NAME_TO_CHARA("輝夜")):1 = 8
CFLAG:(NAME_TO_CHARA("妹紅")):1 = 8
CFLAG:(NAME_TO_CHARA("わかさぎ姫")):1 = 8
CFLAG:(NAME_TO_CHARA("赤蛮奇")):1 = 8
CFLAG:(NAME_TO_CHARA("影狼")):1 = 8

;--------正邪--------
COUNTRY_BOSS:9 = GET_ID(NAME_TO_CHARA("正邪"))
COUNTRY_COLOR:9 = 0XB40404
COUNTRY_AI_TYPE:9 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("輝針城") = 9
CITY_OWNER:GET_CITYNUMBER("無名之丘") = 9
CITY_OWNER:GET_CITYNUMBER("太陽花田") = 9

CFLAG:(NAME_TO_CHARA("ルーミア")):1 = 9
CFLAG:(NAME_TO_CHARA("リグル")):1 = 9
CFLAG:(NAME_TO_CHARA("メディスン")):1 = 9
CFLAG:(NAME_TO_CHARA("雛")):1 = 9
CFLAG:(NAME_TO_CHARA("キスメ")):1 = 9
CFLAG:(NAME_TO_CHARA("ヤマメ")):1 = 9
CFLAG:(NAME_TO_CHARA("パルスィ")):1 = 9
CFLAG:(NAME_TO_CHARA("正邪")):1 = 9

;--------幽香--------
COUNTRY_BOSS:10 = GET_ID(NAME_TO_CHARA("幽香"))
COUNTRY_COLOR:10 = 0XB8D200
COUNTRY_AI_TYPE:10 = AI_好戦

CITY_OWNER:GET_CITYNUMBER("裏山之湖") = 10
CITY_OWNER:GET_CITYNUMBER("夢幻門") = 10
CITY_OWNER:GET_CITYNUMBER("夢幻館") = 10
CITY_OWNER:GET_CITYNUMBER("夢幻界") = 10

CFLAG:(NAME_TO_CHARA("幽香")):1 = 10
CFLAG:(NAME_TO_CHARA("くるみ")):1 = 10
CFLAG:(NAME_TO_CHARA("エリー")):1 = 10
CFLAG:(NAME_TO_CHARA("幻月")):1 = 10
CFLAG:(NAME_TO_CHARA("夢月")):1 = 10

;--------映姫--------
COUNTRY_BOSS:11 = GET_ID(NAME_TO_CHARA("四季映姫"))
COUNTRY_COLOR:11 = 0x792B90
COUNTRY_AI_TYPE:11 = AI_外交

CITY_OWNER:GET_CITYNUMBER("彼岸") = 11
CITY_OWNER:GET_CITYNUMBER("是非曲直庁") = 11
CITY_OWNER:GET_CITYNUMBER("白玉楼") = 11
CITY_OWNER:GET_CITYNUMBER("西行妖") = 11
CITY_OWNER:GET_CITYNUMBER("幽霊待機場所") = 11

CFLAG:(NAME_TO_CHARA("リリカ")):1 = 11
CFLAG:(NAME_TO_CHARA("メルラン")):1 = 11
CFLAG:(NAME_TO_CHARA("ルナサ")):1 = 11
CFLAG:(NAME_TO_CHARA("妖夢")):1 = 11
CFLAG:(NAME_TO_CHARA("半霊")):1 = 11
CFLAG:(NAME_TO_CHARA("幽幽子")):1 = 11
CFLAG:(NAME_TO_CHARA("小町")):1 = 11
CFLAG:(NAME_TO_CHARA("四季映姫")):1 = 11
CFLAG:(NAME_TO_CHARA("ヘカーティア")):1 = 11

;--------鈴仙--------
COUNTRY_BOSS:12 = GET_ID(NAME_TO_CHARA("鈴仙"))
COUNTRY_COLOR:12 = 0xFFF999
COUNTRY_AI_TYPE:12 = AI_防衛

CITY_OWNER:GET_CITYNUMBER("月之都") = 12
CITY_OWNER:GET_CITYNUMBER("月兎街") = 12
CITY_OWNER:GET_CITYNUMBER("綿月亭") = 12
CITY_OWNER:GET_CITYNUMBER("薬搗場") = 12

CFLAG:(NAME_TO_CHARA("てゐ")):1 = 12
CFLAG:(NAME_TO_CHARA("鈴仙")):1 = 12
CFLAG:(NAME_TO_CHARA("豊姫")):1 = 12
CFLAG:(NAME_TO_CHARA("依姫")):1 = 12
CFLAG:(NAME_TO_CHARA("レイセン")):1 = 12
CFLAG:(NAME_TO_CHARA("清蘭")):1 = 12
CFLAG:(NAME_TO_CHARA("鈴瑚")):1 = 12

;指定されなかったキャラは放浪 「あなた」は除外（MASTER入れ替えたときに放浪するのを防ぐ）。
FOR LOCAL:0, 1, CHARANUM
	SIF CFLAG:(LOCAL:0):1 == 0  && CSTR:(LOCAL:0):99 != "あなた"
		CFLAG:(LOCAL:0):特殊状態 = 特殊状態_放浪
NEXT

;兵力の初期配置
CALL INIT_ARMY

;無所属都市の兵数は経済の7.5%
FOR LOCAL:0, 0, MAX_CITY
	SIF CITY_OWNER:(LOCAL:0) == 0
		CITY_SOLDIER:(LOCAL:0) = CITY_ECONOMY:(LOCAL:0) * 75 / 1000
NEXT

;■関係設定
CALL SHARED_SETTING_RELATION

CALL INIT_RELATION("霊夢", "魔理沙", 400, 0)
CALL INIT_RELATION("霊夢", "華扇", 300, 0)
CALL INIT_RELATION("霊夢", "空", 0, 300)
CALL INIT_RELATION("霊夢", "こころ", 300, 0)
CALL INIT_RELATION("霊夢", "星", 300, 300)
CALL INIT_RELATION("霊夢", "クラウンピース", 300, 300)
CALL INIT_RELATION("霊夢", "妹紅", 300, 0)
CALL INIT_RELATION("霊夢", "正邪", 0, 600)
CALL INIT_RELATION("霊夢", "幽香", 300, 300)
CALL INIT_RELATION("霊夢", "四季映姫", 300, 300)
CALL INIT_RELATION("霊夢", "鈴仙", 0, 400)

CALL INIT_RELATION("魔理沙", "霊夢", 500, 0)
CALL INIT_RELATION("魔理沙", "こころ", 300, 0)

CALL INIT_RELATION("空", "霊夢", 500, 500)
CALL INIT_RELATION("空", "魔理沙", 400, 400)
CALL INIT_RELATION("空", "こころ", 300, 300)
CALL INIT_RELATION("空", "クラウンピース", 0, 400)

CALL INIT_RELATION("こころ", "霊夢", 300, 0)
CALL INIT_RELATION("こころ", "空", 300, 0)
CALL INIT_RELATION("こころ", "星", 600, 0)

CALL INIT_RELATION("星", "こころ", 600, 0)

CALL INIT_RELATION("クラウンピース", "霊夢", 0, 400)
CALL INIT_RELATION("クラウンピース", "魔理沙", 0, 300)
CALL INIT_RELATION("クラウンピース", "正邪", 500, 0)
CALL INIT_RELATION("クラウンピース", "鈴仙", 0, 800)

CALL INIT_RELATION("妹紅", "霊夢", 500, 0)
CALL INIT_RELATION("妹紅", "鈴仙", 400, 0)

CALL INIT_RELATION("正邪", "霊夢", 0, 1000)
CALL INIT_RELATION("正邪", "魔理沙", 0, 800)
CALL INIT_RELATION("正邪", "華扇", 0, 800)
CALL INIT_RELATION("正邪", "空", 0, 800)
CALL INIT_RELATION("正邪", "こころ", 0, 800)
CALL INIT_RELATION("正邪", "星", 0, 800)
CALL INIT_RELATION("正邪", "クラウンピース", 1000, 0)
CALL INIT_RELATION("正邪", "妹紅", 0, 800)
CALL INIT_RELATION("正邪", "幽香", 0, 800)
CALL INIT_RELATION("正邪", "四季映姫", 0, 1000)
CALL INIT_RELATION("正邪", "鈴仙", 0, 800)

CALL INIT_RELATION("幽香", "霊夢", 500, 0)
CALL INIT_RELATION("幽香", "魔理沙", 500, 0)

CALL INIT_RELATION("四季映姫", "空", 300, 300)
CALL INIT_RELATION("四季映姫", "こころ", 300, 300)

CALL INIT_RELATION("鈴仙", "霊夢", 500, 0)
CALL INIT_RELATION("鈴仙", "妹紅", 800, 0)
;-------------------------------------------------
;定例イベント
;ターンエンド時に呼び出される
;-------------------------------------------------
@SCENARIO_EVENT_9
#DIM 対象

;5期以降、毎ターン30%で発動
IF DAY >= 5 && RAND:1000 < 300
	CALL SINGLE_DRAWLINE
	SELECTCASE RAND:7
		;お祭り
		CASE 0
			CALL SCENARIO_9_RAND_CITYSELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			PRINTFORML %CITY_NAME:対象%舉行了盛大的祭典
			LOCAL:0 = 1000 * (RAND:3 + 1)
			SETCOLOR カラー_オレンジ
			;経済が成長しきってたら限界を伸ばす
			IF CITY_ECONOMY:対象 == CITY_ECONOMY_LIMIT:対象
				CITY_ECONOMY_LIMIT:対象 += LOCAL:0
				PRINTFORMW %CITY_NAME:対象%的経済規模的上限提高了{LOCAL:0 / 100}、変成了{CITY_ECONOMY_LIMIT:対象 / 100}！
			;成長しきってなければ限界まで伸ばす
			ELSE
				IF CITY_ECONOMY_LIMIT:対象 < (CITY_ECONOMY:対象 + LOCAL:0)
					LOCAL:0 = CITY_ECONOMY_LIMIT:対象 - CITY_ECONOMY:対象
				ENDIF
				CITY_ECONOMY:対象 += LOCAL:0
				PRINTFORMW %CITY_NAME:対象%的経済規模提高了{LOCAL:0 / 100}、変成了{CITY_ECONOMY:対象 / 100}！
			ENDIF
			RESETCOLOR
		;治安悪化
		CASE 1
			CALL SCENARIO_9_RAND_CITYSELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			PRINTFORML 長時間的戦爭讓%CITY_NAME:対象%的治安悪化了
			LOCAL:0 = 1000 * (RAND:3 + 1)
			CITY_ECONOMY:対象 = MAX(CITY_ECONOMY:対象 - LOCAL:0, 0)
			SETCOLOR カラー_オレンジ
			PRINTFORMW %CITY_NAME:対象%的経済規模降低了{LOCAL:0 / 100}、変成了{CITY_ECONOMY_LIMIT:対象 / 100}
			RESETCOLOR
		;天候不順
		CASE 2
			CALL SCENARIO_9_RAND_CITYSELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			LOCAL:0 = 10 * (RAND:3 + 1)
			PRINTFORML 幾年来不順的天気讓%CITY_NAME:対象%的糧食有些不足
			CITY_GUARD:対象 = MAX(CITY_GUARD:対象 - LOCAL:0, 0)
			SETCOLOR カラー_オレンジ
			PRINTFORMW %CITY_NAME:対象%的防衛力減少了{LOCAL:0}、変成了{CITY_GUARD:対象}
			RESETCOLOR
		;義勇軍
		CASE 3
			CALL SCENARIO_9_RAND_CITYSELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			LOCAL:0 = 10 * (RAND:3 + 1)
			PRINTFORML 近年来危機感的提高、讓%CITY_NAME:対象%強化了防衛力
			CITY_GUARD:対象 += 10
			SETCOLOR カラー_オレンジ
			PRINTFORMW %CITY_NAME:対象%的防衛力上昇了{LOCAL:0}、変成了{CITY_GUARD:対象}！
			RESETCOLOR
		;暗殺未遂
		CASE 4
			CALL SCENARIO_9_RAND_CHARASELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			PRINTFORML 據傳言所説%ANAME(対象)%好像遭受了暗殺
			CALL ADD_COOLTIME(対象, 2)
;		;流行病
;		CASE 5
;			CALL SCENARIO_9_RAND_CHARASELECT(1)
;			対象 = RESULT
;			IF 対象 <= 0
;				RETURN
;			ENDIF
;			LOCAL:0 = RAND:3 + 1
;			SELECTCASE RAND:3
;				CASE 0
;					LOCALS = 武闘
;					ABL:対象:武闘 -= MAX(ABL:対象:武闘 - LOCAL:0, 1)
;				CASE 1
;					LOCALS = 知略
;					ABL:対象:知略 -= MAX(ABL:対象:知略 -LOCAL:0, 1)
;				CASE 2
;					LOCALS = 政治
;					ABL:対象:政治 -= MAX(ABL:対象:政治 - LOCAL:0, 1)
;			ENDSELECT
;			PRINTFORML 噂によると%ANAME(対象)%は流行病にかかってしまったらしい
;			SETCOLOR カラー_オレンジ
;			PRINTFORMW %ANAME(対象)%の%LOCALS%が{LOCAL:0}下がり、{ABL:対象:LOCALS}になった
;			RESETCOLOR
		;野心の芽生え
		CASE 6
			CALL SCENARIO_9_RAND_CHARASELECT(1)
			対象 = RESULT
			IF 対象 <= 0
				RETURN
			ENDIF
			LOCAL:0 = RAND:3 + 1
			ABL:対象:野心 += LOCAL:0
			PRINTFORML 據傳言所説%ANAME(対象)%好像有些不忠的行動
			SETCOLOR カラー_オレンジ
			PRINTFORMW %ANAME(対象)%的野心提高了{LOCAL:0}点、変成了{ABL:対象:野心}
			RESETCOLOR

	ENDSELECT
ENDIF

@SCENARIO_9_RAND_CITYSELECT(ARG:0 = 1)
#DIM 対象, MAX_CITY
#DIM カウンタ, 1
VARSET 対象
VARSET カウンタ

;シャッフル用の配列を作成する
FOR LOCAL, 0, MAX_CITY
	IF CITY_TYPE:LOCAL == 1
		BREAK
	ENDIF
	IF ARG:0 || (!ARG:0 && CITY_OWNER:LOCAL == CFLAG:MASTER:1)
		対象:カウンタ = LOCAL
		カウンタ ++
	ENDIF
NEXT

RETURN カウンタ ? 対象:(RAND:カウンタ) # -1

@SCENARIO_9_RAND_CHARASELECT(ARG:0 = 1)

CALL SELECT_CHARA_RANDOM("SCENARIO_9_RAND_CHARASELECT")

RETURN RESULT

@SELECT_CHARA_RANDOM_LOGIC_SCENARIO_9_RAND_CHARASELECT(対象)
#DIM 対象
RETURN !CFLAG:対象:捕虜先 && !CFLAG:対象:特殊状態
