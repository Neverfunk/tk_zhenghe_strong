;-----------------------------------
;基本値計算に先んじて処理するもの
;-----------------------------------
@SKILL_36_TROOP_4_EXIST
RETURN 1

@SKILL_36_TROOP_4_NAME
RESULTS = 我所望见的幻想乡

;レベルは1-5まで
@SKILL_36_TROOP_4_LEVEL
RETURN 5

;対象選択
@SKILL_36_TROOP_4_SETTARGET(発動者, 発動番号, 発動側, 発動勢力, 発動部隊, 対象勢力, 対象部隊)
#DIM 発動者
#DIM 発動番号
#DIM スキル
#DIMS ジャンル
#DIM 発動側
#DIM 発動勢力
#DIM 発動部隊
#DIM 対象側
#DIM 対象勢力
#DIM 対象部隊
対象側 = !発動側
;部隊対象
RETURN 1

;発動判定
@SKILL_36_TROOP_4_CAN_INVOKE(発動者, 発動番号, 発動側, 発動勢力, 発動部隊, 対象勢力, 対象部隊)
#DIM 発動者
#DIM 発動番号
#DIM スキル
#DIMS ジャンル
#DIM 発動側
#DIM 発動勢力
#DIM 発動部隊
#DIM 対象側
#DIM 対象勢力
#DIM 対象部隊
対象側 = !発動側
SIF 対象部隊 < 0 || !IS_COUNTRY(対象勢力) || IS_SP_COUNTRY(対象勢力)
    RETURN 0
RETURN 1

;効果をここに記述
@SKILL_36_TROOP_4_INVOKE(発動者, 発動番号, 発動側, 発動勢力, 発動部隊, 対象勢力, 対象部隊)
#DIM 発動者
#DIM 発動番号
#DIM スキル
#DIMS ジャンル
#DIM 発動側
#DIM 発動勢力
#DIM 発動部隊
#DIM 対象側
#DIM 対象勢力
#DIM 対象部隊

#DIM DYNAMIC 我方判定点
#DIM DYNAMIC 敌方判定点
#DIM DYNAMIC 我方政治
#DIM DYNAMIC 敌方政治
#DIM DYNAMIC 我方都市数
#DIM DYNAMIC 敌方都市数
#DIM DYNAMIC 我方士官数
#DIM DYNAMIC 敌方士官数
対象側 = !発動側

IF 発動部隊<0
    発動勢力 = CITY_OWNER:発動勢力
ENDIF
;判定
FOR LOCAL,0,BATTLE_COMMANDER_NUM:発動側
    我方政治 += ABL_POWER(BATTLE_政治:発動側:LOCAL,BATTLE_COMMANDER:発動側:LOCAL)
    我方判定点+=1
NEXT

FOR LOCAL,0,BATTLE_COMMANDER_NUM:対象側
    敌方政治 += ABL_POWER(BATTLE_政治:対象側:LOCAL,BATTLE_COMMANDER:対象側:LOCAL)
    敌方判定点+=1
NEXT

IF 我方政治>敌方政治
    我方判定点 += MAX(我方政治/敌方政治,1)
ELSE
    敌方判定点 += MAX(敌方政治/我方政治,1)
ENDIF

我方都市数 = GET_OWN_CITY(発動勢力)
敌方都市数 = GET_OWN_CITY(対象勢力)

IF 我方都市数 > 敌方都市数
    我方判定点 += MAX(我方都市数/敌方都市数,1)
ELSE
    敌方判定点 += MAX(敌方都市数/我方都市数,1)
ENDIF

我方士官数 = GET_COMMANDER_NUM(発動勢力) - GET_ANIMAL_NUM(発動勢力) - 1
敌方士官数 = GET_COMMANDER_NUM(対象勢力) - GET_ANIMAL_NUM(対象勢力) - 1

IF 我方士官数 > 敌方士官数
    我方判定点 += MAX(我方士官数/敌方士官数,1)
ELSE
    敌方判定点 += MAX(敌方士官数/我方士官数,1)
ENDIF

;生效
IF 我方判定点 - 敌方判定点 > RAND:5
    ;成功
    LOCAL = BATTLE_COMMANDER_NUM:対象側
    REPEAT LOCAL
        CALL BATTLE_COMMANDER_WITHDRAWAL(対象側,0)
    REND
    CALL CLEAR_UNIT(対象勢力,対象部隊,1)
    CALL CHANGE_RELATION_C_TO_C(発動勢力,対象勢力,RAND(50,150),-1*RAND(300,600))
ELSE
    ;失败
ENDIF



@SKILL_36_TROOP_4_EXPLANATION
RESULTS = 根据我方政治，有一定概率解散敌对幻想势力队伍并提高势力间评价

;以下の三つ、スキル習得で購入させないための処理
@SKILL_36_TROOP_4_NO_LEARN_INIT
@SKILL_36_TROOP_4_CANT_LEARN_FROM_SHOP
@SKILL_36_TROOP_4_CANT_TELL

; 発動率が変動する場合に必要な処理
@SKILL_36_TROOP_4_IS_RATE_VARIABLE
RETURN 1

@SKILL_36_TROOP_4_RATE(発動者, 発動番号, 発動側, 発動勢力, 発動部隊, 対象勢力, 対象部隊)
#DIM 発動者
#DIM 発動番号
#DIM スキル
#DIMS ジャンル
#DIM 発動側
#DIM 発動勢力
#DIM 発動部隊
#DIM 対象側
#DIM 対象勢力
#DIM 対象部隊
[IF_DEBUG]
    RETURN 1000
[ENDIF]
RETURN (BATTLE_COMMANDER_NUM:発動側 * 20 + BATTLE_COMMANDER_NUM:発動側 * 40 + (BATTLE_政治:発動側:発動番号 ) * 3+100)
