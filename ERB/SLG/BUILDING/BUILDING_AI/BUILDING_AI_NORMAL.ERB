
@CLEAR_COUNTRY_REDUNDANT_BUILDING(COUNTRY_ID)
	#DIM COUNTRY_ID
	#DIM CITY_ID
	#DIM SLOT_PTR
	#DIM BUILDING_ID
	FOR CITY_ID, 0, CITY_NUM + 1
		SIF CITY_OWNER:CITY_ID != COUNTRY_ID
			CONTINUE
		FOR SLOT_PTR, 0,MAX_BUILDING_SLOT_NUM
			SIF !BUILDING_SLOT_AVAIL_CHECK(COUNTRY_ID,SLOT_PTR)
				CONTINUE
			BUILDING_ID = CITY_BUILDING:CITY_ID:SLOT_PTR
			SIF BUILDING_ID == 0 ||TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID <= BUILDING_LIMIT_NUM:BUILDING_ID
				CONTINUE
			IF TMP_CITY_RISK:COUNTRY_ID:CITY_ID >= 4
				CALL AI_DEL_BUILDING(CITY_ID,SLOT_PTR)
				TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID--
				SIF TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID == 0
					TMP_BUILDING_EXIST_FLAG:(COUNTRY_ID):BUILDING_ID = 0
			ENDIF
		NEXT
	NEXT

	FOR CITY_ID, 0, CITY_NUM + 1
		SIF CITY_OWNER:CITY_ID != COUNTRY_ID
			CONTINUE
		FOR SLOT_PTR, 0,MAX_BUILDING_SLOT_NUM
			SIF !BUILDING_SLOT_AVAIL_CHECK(COUNTRY_ID,SLOT_PTR)
				CONTINUE
			BUILDING_ID = CITY_BUILDING:CITY_ID:SLOT_PTR
			SIF BUILDING_ID == 0 ||TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID <= BUILDING_LIMIT_NUM:BUILDING_ID
				CONTINUE
			CALL AI_DEL_BUILDING(CITY_ID,SLOT_PTR)
			TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID--
			SIF TMP_BUILDING_CNT:(COUNTRY_ID):BUILDING_ID == 0
				TMP_BUILDING_EXIST_FLAG:(COUNTRY_ID):BUILDING_ID = 0
		NEXT
	NEXT



@SLG_NORMAL_AI_CLEAR_UNNECESSERY_BUILDING(COUNTRY_ID)
	#DIM COUNTRY_ID
	#DIM CITY_ID
	#DIM BUILDING_ID
	FOR CITY_ID, 0, CITY_NUM + 1
		SIF CITY_OWNER:CITY_ID != COUNTRY_ID
			CONTINUE
		SIF CITY_ECONOMY_LIMIT:CITY_ID /100 >= GET_CITY_ECONOMY_REQ(COUNTRY_ID,建造物_等级_三级建筑,1)
			CALL CLEAR_HIGH_ECONOMY_CIYT_BUILDING(CITY_ID)
		SIF COUNTRY_TECH_IS_FULL(COUNTRY_ID) == 1
			CALL CLEAR_CITY_TECH_BUILDING(CITY_ID)
		SIF TMP_CITY_RISK:COUNTRY_ID:CITY_ID == 0
			CALL CLEAR_SAFE_CITY_UNNECESSERY_BUILDING(CITY_ID)
		CALL CLEAR_DANGER_CITY_UNNECESSERY_BUILDING(CITY_ID)
		CALL CLEAR_CITY_MASTER_BUILDING(CITY_ID)
	NEXT
	CALL TMP_BUILDING_EXIST_MAP
	CALL CLEAR_COUNTRY_REDUNDANT_BUILDING(COUNTRY_ID)

@SLG_AI_CAL_CITY_DANGER_NUM(COUNTRY_ID)
	#DIM COUNTRY_ID
	#DIM CITY_ID
	#DIM 安全都市, MAX_CITY
	#DIM 安全都市数
	#DIM 危険都市, MAX_CITY
	#DIM 危険都市数
	#DIM 警戒都市, MAX_CITY
	#DIM 警戒都市数
	FOR CITY_ID, 0, CITY_NUM + 1
		SIF CITY_OWNER:COUNTRY_ID != COUNTRY_ID
			CONTINUE
		IF TMP_CITY_RISK:COUNTRY_ID:CITY_ID >= 4
			危険都市数 ++
		ELSEIF TMP_CITY_RISK:COUNTRY_ID:CITY_ID == 0
			安全都市数 ++
		ELSEIF TMP_CITY_RISK:COUNTRY_ID:CITY_ID >= 1
			警戒都市数 ++
		ENDIF
	NEXT
	RESULT:0 = 危険都市数
	RESULT:1 = 安全都市数
	RESULT:2 = 警戒都市数

@SLG_AI_DANGER_CITY_BUILDING(CITY_ID)
	#DIM CITY_ID
	#DIM SLOT_PTR
	#DIM BUILDING_ID
	FOR SLOT_PTR, 0,MAX_BUILDING_SLOT_NUM
		SIF !BUILDING_SLOT_AVAIL_CHECK(CITY_OWNER:CITY_ID,SLOT_PTR)
			RETURN
		SIF CITY_BUILDING:CITY_ID:SLOT_PTR > 0
			CONTINUE
		IF TMP_BUILDING_EXIST_FLAG:(CITY_OWNER:(CITY_ID)):(建造物_长程火炮阵地) < 1
			IF !CHECK_CITY_HAVE_BUILDING(CITY_ID,建造物_弓櫓) && !CHECK_CITY_HAVE_BUILDING(CITY_ID,建造物_守卫炮台)
				CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_守卫炮台)
				SIF RESULT:0 != 1
					CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_弓櫓)
			ENDIF
		ENDIF
		SIF !CHECK_CITY_HAVE_BUILDING(CITY_ID,建造物_野战基地) && RESULT:0 != 1
			CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_野战基地)
		SIF !CHECK_CITY_HAVE_BUILDING(CITY_ID,建造物_前线指挥所) && RESULT:0 != 1
			CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_前线指挥所)
		SIF !CHECK_CITY_HAVE_BUILDING(CITY_ID,建造物_伤兵医院) && RESULT:0 != 1
			CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_伤兵医院)
	NEXT

@SLG_AI_DANGER_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
	#DIM CITY_ID
	#DIM SLOT_PTR
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_指挥部)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_参谋部)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_情报部)
	; SIF RESULT:0 != 1
	; 	CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_长程火炮阵地)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_大型仓库)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_军宣部)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_大本营)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_短波电台)
	RETURN RESULT:0

@SLG_AI_SAFE_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
	#DIM CITY_ID
	#DIM SLOT_PTR
	SIF RESULT:0 != 1 && TMP_BUILDING_CNT:(CITY_OWNER:(CITY_ID)):(建造物_独占市场)>=5
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_全国市场)
	SIF RESULT:0 != 1 && TMP_BUILDING_CNT:(CITY_OWNER:(CITY_ID)):(建造物_基础工业园区)>=5
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_高新工业园区)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_度假区)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_大宴会场)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_定向实验室)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_人力资源部)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_社会保障部)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_长波电台)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_科研大楼)
	SIF RESULT:0 != 1
		CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_忍者之里)
	RETURN RESULT:0

@SLG_AI_SAFE_CITY_BUILDING(CITY_ID,COUNTRY_SAFE_SITUATION)
	#DIM CITY_ID
	#DIM COUNTRY_SAFE_SITUATION
	#DIM SLOT_PTR
	#DIM BUILDING_ID
	FOR SLOT_PTR, 0,MAX_BUILDING_SLOT_NUM
		SIF !BUILDING_SLOT_AVAIL_CHECK(CITY_OWNER:CITY_ID,SLOT_PTR)
			RETURN
		SIF CITY_BUILDING:CITY_ID:SLOT_PTR > 0
			CONTINUE
		IF COUNTRY_SAFE_SITUATION
			CALL SLG_AI_SAFE_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
			SIF RESULT:0 != 1
				CALL SLG_AI_DANGER_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
		ELSE
			CALL SLG_AI_DANGER_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
			SIF RESULT:0 != 1
				CALL SLG_AI_SAFE_SITUATION_BUILDING(CITY_ID,SLOT_PTR)
		ENDIF
		IF RESULT:0 != 1
			SIF (CITY_ECONOMY_LIMIT:CITY_ID)/100 < GET_CITY_ECONOMY_REQ(CITY_OWNER,建造物_等级_三级建筑,1)
				CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_基础工业园区)
			SIF RESULT:0 != 1
				CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_研究所)
			IF RESULT:0 != 1
				IF COUNTRY_SAFE_SITUATION
					CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_独占市场)
				ELSE
					CALL AI_BUILD_BUILDING(CITY_ID,SLOT_PTR,建造物_兵舎)
				ENDIF
			ENDIF
		ENDIF
	NEXT

@SLG_AI_BUILDING_NORMAL(COUNTRY_ID)
	#DIM COUNTRY_ID
	#DIM CITY_ID
	#DIM 安全都市数
	#DIM 危険都市数
	#DIM 警戒都市数
	#DIM COUNTRY_SAFE_SITUATION
	CALL SLG_NORMAL_AI_CLEAR_UNNECESSERY_BUILDING(COUNTRY_ID)
	CALL AL_BUILDING_TOHO_BUILDING(COUNTRY_ID)
	CALL SLG_AI_CAL_CITY_DANGER_NUM(COUNTRY_ID)
	安全都市数 = RESULT:0
	危険都市数 = RESULT:1
	警戒都市数 = RESULT:2
	COUNTRY_SAFE_SITUATION = ((RESULT:0) * 3 < (RESULT:0+RESULT:1+RESULT:2)) ? 1 # 0
	FOR CITY_ID, 0, CITY_NUM + 1
		SIF CITY_OWNER:CITY_ID != COUNTRY_ID
			CONTINUE
		IF TMP_CITY_RISK:COUNTRY_ID:CITY_ID >= 4
			;#;PRINTFORML 危险都市%CITY_NAME:CITY_ID%建造
			CALL SLG_AI_DANGER_CITY_BUILDING(CITY_ID)
		ELSE
			;#;PRINTFORML 安全都市%CITY_NAME:CITY_ID%建造
			CALL SLG_AI_SAFE_CITY_BUILDING(CITY_ID,COUNTRY_SAFE_SITUATION)
		ENDIF
	NEXT
	;#;PRINTFORMW AI建造完毕
