;コマンド関係の共通関数(特にソースに関わるもの)をまとめる

;-------------------------------------------------
;主導権に応じた優越・屈従のソースを加算する関数
;ARG:0=キャラ番号、ARG:1=優越の加算値、ARG:2=屈従の加算値
;-------------------------------------------------
@ADD_SOURCE_INITIATIVE_U(ARG:0, ARG:1, ARG:2)
;主導権をチェック
SELECTCASE GET_COM_INITIATIVE()
	;主導権がプレイヤー側
	CASE 0
		;ARG:0番のキャラがプレイヤー側
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 0
		ELSE
			LOCAL:3 = 2
		ENDIF
	;主導権がターゲット側
	CASE 1
		;ARG:0番のキャラがプレイヤー側
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 2
		ELSE
			LOCAL:3 = 0
		ENDIF
	;主導権が両方
	CASE 2
		LOCAL:3 = 1
	;主導権がどちらにもない
	CASE 3
		LOCAL:3 = 3
ENDSELECT

;主導権が両方・どちらにもない状況ではソース半減
IF LOCAL:3 == 1 || LOCAL:3 == 3
	LOCAL:0 = 2
ELSE
	LOCAL:0 = 1
ENDIF

;ARG:0番のキャラが主導権を持つ
IF LOCAL:3 == 0 || LOCAL:3 == 1
	SOURCE:(ARG:0):優越 += ARG:1 / LOCAL:0
ELSE
	SOURCE:(ARG:0):屈従 += ARG:2 / LOCAL:0
ENDIF

;-------------------------------------------------
;主導権に応じた主導・受動のソースを加算する関数
;ARG:0=キャラ番号、ARG:1=主導の加算値、ARG:2=受動の加算値
;-------------------------------------------------
@ADD_SOURCE_INITIATIVE_N(ARG:0, ARG:1, ARG:2)
;主導権をチェック
SELECTCASE GET_COM_INITIATIVE()
	;主導権がプレイヤー側
	CASE 0
		;ARG:0番のキャラがプレイヤー側
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 0
		ELSE
			LOCAL:3 = 2
		ENDIF
	;主導権がターゲット側
	CASE 1
		;ARG:0番のキャラがプレイヤー側
		IF IS_MPLY(ARG:0)
			LOCAL:3 = 2
		ELSE
			LOCAL:3 = 0
		ENDIF
	;主導権が両方
	CASE 2
		LOCAL:3 = 1
	;主導権がどちらにもない
	CASE 3
		LOCAL:3 = 3
ENDSELECT

;主導権が両方・どちらにもない状況ではソース半減
IF LOCAL:3 == 1 || LOCAL:3 == 3
	LOCAL:0 = 2
ELSE
	LOCAL:0 = 1
ENDIF

;ARG:0番のキャラが主導権を持つ
IF LOCAL:3 == 0 || LOCAL:3 == 1
	SOURCE:(ARG:0):主導 += ARG:1 / LOCAL:0
ELSE
	SOURCE:(ARG:0):受動 += ARG:2 / LOCAL:0
ENDIF

;-------------------------------------------------
;好感度に応じた歓楽のソースを加算する関数
;ARG:0=キャラ番号、ARG:1=倍率
;-------------------------------------------------
@ADD_SOURCE_KANRAKU(ARG:0, ARG:1)
IF CFLAG:(ARG:0):2 < 100
	LOCAL:0 = MAX(CFLAG:(ARG:0):2 * 20 / 100, 0)
ELSEIF CFLAG:(ARG:0):2 < 300
	LOCAL:0 = 20 + (CFLAG:(ARG:0):2 - 100) * 10 / 200
ELSEIF CFLAG:(ARG:0):2 < 500
	LOCAL:0 = 30 + (CFLAG:(ARG:0):2 - 300) * 10 / 200
ELSEIF CFLAG:(ARG:0):2 < 800
	LOCAL:0 = 40 + (CFLAG:(ARG:0):2 - 500) * 10 / 300
ELSEIF CFLAG:(ARG:0):2 < 1500
	LOCAL:0 = 50 + (CFLAG:(ARG:0):2 - 800) * 10 / 700
ELSEIF CFLAG:(ARG:0):2 < 5000
	LOCAL:0 = 60 + (CFLAG:(ARG:0):2 - 1500) * 10 / 4500
ELSEIF CFLAG:(ARG:0):2 < 55000
	LOCAL:0 = 70 + (CFLAG:(ARG:0):2 - 5000) * 20 / 50000
ELSE
	LOCAL:0 = 90 + (CFLAG:(ARG:0):2 - 55000) / 20000
ENDIF

LOCAL:0 = MAX(LOCAL:0, 0)

;設定された倍率に応じた補正を掛け歓楽のソースを追加
SOURCE:(ARG:0):歓楽 += LOCAL:0 * ARG:1 / 100

;-------------------------------------------------
;好感度に応じた愛情のソースを加算する関数
;ARG:0=キャラ番号、ARG:1=倍率
;-------------------------------------------------
@ADD_SOURCE_AIZYOU(ARG:0, ARG:1)
LOCAL:1 = CFLAG:(ARG:0):2
IF LOCAL:1 < 100
	LOCAL:0 = MAX(LOCAL:1 / 50, 0)
ELSEIF LOCAL:1 < 300
	LOCAL:0 = 10 + (LOCAL:1 - 100) / 20
ELSEIF LOCAL:1 < 500
	LOCAL:0 = 30 + (LOCAL:1 - 300) / 20
ELSEIF LOCAL:1 < 800
	LOCAL:0 = 50 + (LOCAL:1 - 500) / 30
ELSEIF LOCAL:1 < 1500
	LOCAL:0 = 70 + (LOCAL:1 - 800) / 35
ELSEIF LOCAL:1 < 5000
	LOCAL:0 = 100 + (LOCAL:1 - 1500) / 100
ELSEIF LOCAL:1 < 55000
	LOCAL:0 = 135 + (LOCAL:1 - 5000) / 500
ELSE
	LOCAL:0 = 235 + (LOCAL:1 - 55000) / 20000
ENDIF

;設定された倍率に応じた補正を掛け愛情のソースを追加
SOURCE:(ARG:0):愛情 += LOCAL:0 * ARG:1 / 100

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(Ｐ以外への侍奉系)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_HOUSHI(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 0.75
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.25
	CASE 4
		TIMES LOCAL:0, 1.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 4 + 154) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.04
	CASE 2
		TIMES LOCAL:0, 1.08
	CASE 3
		TIMES LOCAL:0, 1.12
	CASE 4
		TIMES LOCAL:0, 1.16
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 120) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF

SIF IS_ANIMAL(ARG:0)
	LOCAL:0 = ANIMAL_SOURCE_MULTIPLIER(ARG:1, LOCAL:0)

RETURNF LOCAL:0

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(Ｐへの侍奉系)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_HOUSHI_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.50
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.60
	CASE 3
		TIMES LOCAL:0, 2.20
	CASE 4
		TIMES LOCAL:0, 2.80
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 10 + 290) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 135) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1

ENDIF

SIF IS_ANIMAL(ARG:0)
	LOCAL:0 = ANIMAL_SOURCE_MULTIPLIER(ARG:1, LOCAL:0)

RETURNF LOCAL:0

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(性交系・プレイヤー側・Ｐ以外)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_SEX_PLAYER(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.7
	CASE 1
		TIMES LOCAL:0, 0.85
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.30
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 2 + 132) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.05
	CASE 2
		TIMES LOCAL:0, 1.10
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 123) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):性交
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性交 - 5) * 1 + 130) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8


;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(性交系・ターゲット側・Ｐ以外)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_SEX_TARGET(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 0.75
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.30
	CASE 4
		TIMES LOCAL:0, 1.60
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 3 + 163) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.05
	CASE 2
		TIMES LOCAL:0, 1.10
	CASE 3
		TIMES LOCAL:0, 1.15
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 123) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):性交
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性交 - 5) * 1 + 130) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF

	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(性交系・プレイヤー側・快Ｐ専用)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_SEX_PLAYER_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.70
	CASE 1
		TIMES LOCAL:0, 0.85
	CASE 2
		TIMES LOCAL:0, 1.00
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.40
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 3 + 143) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 135) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):性交
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性交 - 5) * 1 + 130) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;主人公には侍奉・性交の補正がないためデフォルトで快感量上昇
	TIMES LOCAL:0, 1.70

	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1

ENDIF

RETURNF LOCAL:0

;-------------------------------------------------
;快感系ソースに必要な補正を掛けた値を返す関数(性交系・ターゲット側・快Ｐ専用)
;ARG:0=侍奉側のキャラ番号、ARG:1=相手のキャラ番号、ARG:2=快感ソースの基本値
;-------------------------------------------------
@SENSE_SEX_TARGET_P(ARG:0, ARG:1, ARG:2)
#FUNCTION
LOCAL:0 = ARG:2

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.5
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.50
	CASE 3
		TIMES LOCAL:0, 2.00
	CASE 4
		TIMES LOCAL:0, 2.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 9 + 259) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.07
	CASE 2
		TIMES LOCAL:0, 1.14
	CASE 3
		TIMES LOCAL:0, 1.21
	CASE 4
		TIMES LOCAL:0, 1.28
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 135) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):性交
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.10
	CASE 2
		TIMES LOCAL:0, 1.15
	CASE 3
		TIMES LOCAL:0, 1.20
	CASE 4
		TIMES LOCAL:0, 1.25
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性交 - 5) * 1 + 130) / 100
ENDSELECT

;侍奉対象が主人公の場合
IF ARG:1 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.60
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.70
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.85
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.95
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:0):親愛 || TALENT:(ARG:0):隷属 || TALENT:(ARG:0):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):服従 || TALENT:(ARG:0):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:0):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

;主人公による侍奉の場合
ELSEIF ARG:0 == MASTER
	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:1 = MAX(CFLAG:(ARG:1):2, CFLAG:(ARG:1):4, CFLAG:(ARG:1):5)
	IF LOCAL:1 < 100
		TIMES LOCAL:0, 0.80
	ELSEIF LOCAL:1 < 300
		TIMES LOCAL:0, 0.84
	ELSEIF LOCAL:1 < 500
		TIMES LOCAL:0, 0.88
	ELSEIF LOCAL:1 < 800
		TIMES LOCAL:0, 0.92
	ELSEIF LOCAL:1 < 1500
		TIMES LOCAL:0, 0.96
	ELSEIF LOCAL:1 < 10000
		LOCAL:0 = LOCAL:0 * ((LOCAL:1 - 1500) / 85 + 1000) / 1000
	ELSE
		LOCAL:0 = LOCAL:0 * MIN((LOCAL:1 - 10000) / 1000 + 1100, 1500) / 1000
	ENDIF

	IF TALENT:(ARG:1):親愛 || TALENT:(ARG:1):隷属 || TALENT:(ARG:1):所有者
		TIMES LOCAL:0, 1.20
	ELSEIF TALENT:(ARG:1):恋慕 || TALENT:(ARG:1):服従 || TALENT:(ARG:1):主人
		TIMES LOCAL:0, 1.10
	ELSEIF TALENT:(ARG:1):親友
		TIMES LOCAL:0, 1.05
	ENDIF
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8

ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
	SIF GETBIT(TALENT:(ARG:1):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1

ENDIF



RETURNF LOCAL:0

;-------------------------------------------------
;侍奉のソースに、ARG:0番のキャラの侍奉・性技による補正値を掛けて返す関数(侍奉系)
;ARG:1=ソースの基本値
;-------------------------------------------------
@SERVE_HOUSHI(ARG:0, ARG:1)
#FUNCTION
LOCAL:0 = ARG:1

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.15
	CASE 2
		TIMES LOCAL:0, 1.30
	CASE 3
		TIMES LOCAL:0, 1.45
	CASE 4
		TIMES LOCAL:0, 1.60
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 2 + 170) / 100
ENDSELECT

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.40
	CASE 1
		TIMES LOCAL:0, 0.60
	CASE 2
		TIMES LOCAL:0, 0.80
	CASE 3
		TIMES LOCAL:0, 1.00
	CASE 4
		TIMES LOCAL:0, 1.20
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 2 + 140) / 100
ENDSELECT

RETURNF LOCAL:0

;-------------------------------------------------
;侍奉・達成のソースに、ARG:0番のキャラの侍奉・性技による補正値を掛けて返す関数(性交系)
;ARG:1=ソースの基本値
;-------------------------------------------------
@SERVE_SEX(ARG:0, ARG:1)
#FUNCTION
LOCAL:0 = ARG:1

SELECTCASE ABL:(ARG:0):奉仕
	CASE 0
		TIMES LOCAL:0, 1.00
	CASE 1
		TIMES LOCAL:0, 1.20
	CASE 2
		TIMES LOCAL:0, 1.40
	CASE 3
		TIMES LOCAL:0, 1.60
	CASE 4
		TIMES LOCAL:0, 1.80
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):奉仕 - 5) * 1 + 20) / 10
ENDSELECT

SELECTCASE ABL:(ARG:0):性技
	CASE 0
		TIMES LOCAL:0, 0.50
	CASE 1
		TIMES LOCAL:0, 1.00
	CASE 2
		TIMES LOCAL:0, 1.50
	CASE 3
		TIMES LOCAL:0, 2.00
	CASE 4
		TIMES LOCAL:0, 2.50
	CASEELSE
		LOCAL:0 = LOCAL:0 * ((ABL:(ARG:0):性技 - 5) * 2 + 34) / 10
ENDSELECT

RETURNF LOCAL:0

;-------------------------------------------------
;性交の共通ソース補正(挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_SEX_P(ARG:0, ARG:1)

SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 250)

SELECTCASE ABL:(ARG:1):Ｖ感
	CASE 0
		TIMES SOURCE:(ARG:0):愛情, 0.90
	CASE 1
		TIMES SOURCE:(ARG:0):愛情, 0.95
	CASE 2
		TIMES SOURCE:(ARG:0):愛情, 1.00
	CASE 3
		TIMES SOURCE:(ARG:0):愛情, 1.05
	CASE 4
		TIMES SOURCE:(ARG:0):愛情, 1.10
	CASEELSE
		SOURCE:(ARG:0):愛情 = SOURCE:(ARG:0):愛情 * MIN((ABL:(ARG:1):Ｖ感 - 5) * 1 + 115, 300) / 100
ENDSELECT

IF PALAM:(ARG:1):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ｐ, 0.30
	TIMES SOURCE:(ARG:0):愛情, 0.50
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ｐ, 0.60
	TIMES SOURCE:(ARG:0):愛情, 0.80
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ｐ, 0.80
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ｐ, 0.90
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):快Ｐ, 1.00
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF PALAM:(ARG:0):欲情 < PALAMLV:1
	TIMES SOURCE:(ARG:0):愛情, 0.40
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:3
	TIMES SOURCE:(ARG:0):愛情, 0.70
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:5
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:7
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF TALENT:(ARG:0):童貞
	TIMES SOURCE:(ARG:0):愛情, 2.50
ENDIF

IF TALENT:(ARG:1):処女
	TIMES SOURCE:(ARG:0):愛情, 2.50
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):親友
		IF TALENT:(ARG:0):貞操観念
			TIMES SOURCE:(ARG:0):愛情, 1.50
		ELSEIF TALENT:(ARG:0):不在乎貞操
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ENDIF
	ELSE
		IF TALENT:(ARG:0):貞操観念
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 2500
			ELSE
				SOURCE:(ARG:0):反感 = 500
			ENDIF
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ELSEIF !TALENT:(ARG:0):不在乎貞操
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):恋人
			TIMES SOURCE:(ARG:0):反感, 0.10
		ENDIF
	ENDIF

	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):反感, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):反感, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):反感, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):反感, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):反感, 0.15
	ELSE
		SOURCE:(ARG:0):反感 = SOURCE:(ARG:0):反感 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF

CALL DOUTEI_COMMON(ARG:0, @"%ANAME(ARG:1)%的小穴", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ｖ挿入経験 ++

IF TALENT:(ARG:0):童貞 && HAS_PENIS(ARG:0)
	IF ARG:1 == MASTER
		;童貞喪失フラグ(主人との性交)
		TCVAR:(ARG:0):14 = 1
	ELSE
		;童貞喪失フラグ(主人以外との性交)
		TCVAR:(ARG:0):14 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;性交の共通ソース補正(被挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_SEX_V(ARG:0, ARG:1)
SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 200)

SELECTCASE ABL:(ARG:0):Ｖ感
	CASE 0
		SOURCE:(ARG:0):苦痛 += 300
	CASE 1
		SOURCE:(ARG:0):苦痛 += 100
	CASE 2
		SOURCE:(ARG:0):苦痛 += 30
ENDSELECT

IF PALAM:(ARG:0):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ｖ, 0.05
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 4 + 1000
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ｖ, 0.20
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 2 + 300
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ｖ, 0.60
	TIMES SOURCE:(ARG:0):苦痛, 1.00
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ｖ, 0.85
	TIMES SOURCE:(ARG:0):苦痛, 0.70
ELSE
	TIMES SOURCE:(ARG:0):快Ｖ, 1.00
	TIMES SOURCE:(ARG:0):苦痛, 0.50
ENDIF

IF TALENT:(ARG:0):体格 == 体格_子供 && TALENT:(ARG:1):体格 != 体格_子供
	IF TALENT:(ARG:1):体格 == 体格_小柄
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	ELSE
		TIMES SOURCE:(ARG:0):苦痛, 2.50
	ENDIF
ELSEIF TALENT:(ARG:0):体格 == 体格_小柄 && TALENT:(ARG:1):体格 != 体格_小柄 && TALENT:(ARG:1):体格 != 体格_子供
	TIMES SOURCE:(ARG:0):苦痛, 1.50
ENDIF

;竿サイズで痛みと快感の変動
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		TIMES SOURCE:(ARG:0):快Ｖ, 0.50
		TIMES SOURCE:(ARG:0):苦痛, 0.50
	CASE -1
		TIMES SOURCE:(ARG:0):快Ｖ, 0.75
		TIMES SOURCE:(ARG:0):苦痛, 0.75
	CASE 1
		TIMES SOURCE:(ARG:0):快Ｖ, 1.25
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	CASE 2
		TIMES SOURCE:(ARG:0):快Ｖ, 1.50
		TIMES SOURCE:(ARG:0):苦痛, 2.00
ENDSELECT

;挿入側のABL性交で痛み軽減　ただし1～3までは痛み増加　4でやっと等倍　100からは減少しない
SELECTCASE ABL:(ARG:1):性交
	CASE 0 TO 100
		SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * (120 - SQRT(100 * ABL:(ARG:1):性交)) / 100
	CASEELSE
		TIMES SOURCE:(ARG:0):苦痛, 0.20
ENDSELECT

IF TALENT:(ARG:0):処女 == 1
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 2 + 500
ENDIF

IF IS_ANIMAL(ARG:1)
	SOURCE:(ARG:0):苦痛 = ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, SOURCE:(ARG:0):苦痛)
	SOURCE:(ARG:0):快Ｖ = ANIMAL_SOURCE_MULTIPLIER(ARG:0, SOURCE:(ARG:0):快Ｖ)
	IF TALENT:(ARG:1):動物 == 動物_馬
		EXP:(ARG:0):Ｖ拡張経験 += 1
		CALL TIGHTNESS_DECREASE_V(ARG:0, RAND(3, 8))
	ENDIF
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):親友
		IF TALENT:(ARG:0):貞操観念
			TIMES SOURCE:(ARG:0):愛情, 1.50
		ELSEIF TALENT:(ARG:0):不在乎貞操
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ENDIF
		IF TALENT:(ARG:0):処女
			SOURCE:(ARG:0):歓喜 += 1000
			SIF TALENT:(ARG:0):恋人
				SOURCE:(ARG:0):歓喜 += 1500
			SIF TALENT:(ARG:0):親愛
				SOURCE:(ARG:0):歓喜 += 2500
		ENDIF
	ELSE
		IF TALENT:(ARG:0):貞操観念
			IF TALENT:(ARG:0):処女
				SOURCE:(ARG:0):反感 = 5000
			ELSE
				SOURCE:(ARG:0):反感 = 1000
			ENDIF
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ELSEIF TALENT:(ARG:0):不在乎貞操
			IF TALENT:(ARG:0):処女
				SOURCE:(ARG:0):反感 = 300
			ENDIF
		ELSE
			IF TALENT:(ARG:0):処女
				SOURCE:(ARG:0):反感 = 2500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):恋人
			TIMES SOURCE:(ARG:0):反感, 0.10
		ENDIF
	ENDIF

	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):反感, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):反感, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):反感, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):反感, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):反感, 0.15
	ELSE
		SOURCE:(ARG:0):反感 = SOURCE:(ARG:0):反感 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF

IF !IS_EQUIP_PLAYER(ARG:1, 75) && GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_生ハメ依存)
	SOURCE:(ARG:0):歓喜 += 500
ENDIF

CALL VIRGIN_COMMON(ARG:0, @"%ANAME(ARG:1)%", GET_SITUATION_BY_TRAIN_MODE())

SIF GET_SITUATION_BY_TRAIN_MODE() == "調教" && IS_INSERT_SINGLE(ARG:0, "Ａ")
	EXP:(ARG:0):輪姦経験 ++
{
	SIF GET_SITUATION_BY_TRAIN_MODE() == "調教" && (
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "口交")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "舔舐睪丸")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "乳交")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "Ａ顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "強制口交"))
		)
}
	EXP:(ARG:0):輪姦経験 ++


;対象の膣が緩む(竿のサイズで変動)
;超短小(0～1) 短小(0～2) 普通(1～3) 巨根(2～4) 超巨根(3～4)
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		LOCAL:1 = RAND(0, 2)
	CASE -1
		LOCAL:1 = RAND(0, 3)
	CASE 0
		LOCAL:1 = RAND(1, 4)
	CASE 1
		LOCAL:1 = RAND(2, 5)
	CASE 2
		LOCAL:1 = RAND(3, 5)
ENDSELECT

;★if difference between sizes is big, increase the stretching
SELECTCASE TALENT:(ARG:0):Ｖ緊緻度
	CASE IS >= 締まり_ぎちぎち ;unused
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 7.5 = 11
			LOCAL:1 += RAND(5, 11)
			EXP:(ARG:0):Ｖ拡張経験 ++
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 5 = 8
			LOCAL:1 += RAND(3, 8)
		ELSEIF GET_PENISSIZE(ARG:1) == 0
			;2 + 3 = 5
			LOCAL:1 += RAND(2, 5)
		ENDIF
	CASE IS >= 締まり_きつきつ ;shut tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 5 = 8.5
			LOCAL:1 += RAND(3, 8)
			EXP:(ARG:0):Ｖ拡張経験 ++
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 3 = 6
			LOCAL:1 += RAND(2, 5)
		ENDIF
	CASE IS >= 締まり_きゅっきゅっ ;very tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 1 = 4.5
			LOCAL:1 += RAND(0, 3)
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 0.5 = 3.5
			LOCAL:1 += RAND:2
		ENDIF
	CASE IS >= 締まり_名器 ;tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 0.5 = 4
			LOCAL:1 += RAND:2
		ENDIF
ENDSELECT
CALL TIGHTNESS_DECREASE_V(ARG:0, LOCAL:1)

EXP:(ARG:0):Ｖ性交経験 ++


IF TALENT:(ARG:0):処女
	IF ARG:1 == MASTER
		;処女喪失フラグ(主人との性交)
		TCVAR:(ARG:0):13 = 1
	ELSE
		;処女喪失フラグ(主人以外との性交)
		TCVAR:(ARG:0):13 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;Ａ性交の共通ソース補正(挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_ASEX_P(ARG:0, ARG:1)

SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 250)

SELECTCASE ABL:(ARG:1):Ａ感
	CASE 0
		TIMES SOURCE:(ARG:0):愛情, 0.60
	CASE 1
		TIMES SOURCE:(ARG:0):愛情, 0.80
	CASE 2
		TIMES SOURCE:(ARG:0):愛情, 0.90
	CASE 3
		TIMES SOURCE:(ARG:0):愛情, 1.00
	CASE 4
		TIMES SOURCE:(ARG:0):愛情, 1.10
	CASEELSE
		SOURCE:(ARG:0):愛情 = SOURCE:(ARG:0):愛情 * ((ABL:(ARG:1):Ｖ感 - 5) * 1 + 115) / 100
ENDSELECT

IF PALAM:(ARG:1):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ｐ, 0.30
	TIMES SOURCE:(ARG:0):愛情, 0.50
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ｐ, 0.60
	TIMES SOURCE:(ARG:0):愛情, 0.80
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ｐ, 0.80
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ｐ, 0.90
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):快Ｐ, 1.00
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF PALAM:(ARG:0):欲情 < PALAMLV:1
	TIMES SOURCE:(ARG:0):愛情, 0.40
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:3
	TIMES SOURCE:(ARG:0):愛情, 0.70
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:5
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:7
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF TALENT:(ARG:0):童貞
	TIMES SOURCE:(ARG:0):愛情, 2.50
ENDIF

IF TALENT:(ARG:1):処女
	TIMES SOURCE:(ARG:0):愛情, 2.50
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):親友
		IF TALENT:(ARG:0):貞操観念
			TIMES SOURCE:(ARG:0):愛情, 1.50
		ELSEIF TALENT:(ARG:0):不在乎貞操
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ENDIF
	ELSE
		IF TALENT:(ARG:0):貞操観念
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 2500
			ELSE
				SOURCE:(ARG:0):反感 = 500
			ENDIF
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ELSEIF !TALENT:(ARG:0):不在乎貞操
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):恋人
			TIMES SOURCE:(ARG:0):反感, 0.10
		ENDIF
	ENDIF

	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):反感, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):反感, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):反感, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):反感, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):反感, 0.15
	ELSE
		SOURCE:(ARG:0):反感 = SOURCE:(ARG:0):反感 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF

CALL DOUTEI_COMMON(ARG:0, @"%ANAME(ARG:1)%的肛门", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ａ挿入経験 ++

IF TALENT:(ARG:0):童貞 && HAS_PENIS(ARG:0)
	IF ARG:1 == MASTER
		;童貞喪失フラグ(主人との性交)
		TCVAR:(ARG:0):14 = 1
	ELSE
		;童貞喪失フラグ(主人以外との性交)
		TCVAR:(ARG:0):14 = 3
	ENDIF
ENDIF

;-------------------------------------------------
;Ａ性交の共通ソース補正(被挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_ASEX_A(ARG:0, ARG:1)
SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 150)

SELECTCASE ABL:(ARG:0):Ａ感
	CASE 0
		TIMES SOURCE:(ARG:0):愛情, 0.30
		SOURCE:(ARG:0):苦痛 += 1200
	CASE 1
		TIMES SOURCE:(ARG:0):愛情, 0.60
		SOURCE:(ARG:0):苦痛 += 500
	CASE 2
		TIMES SOURCE:(ARG:0):愛情, 0.90
		SOURCE:(ARG:0):苦痛 += 200
	CASE 3
		TIMES SOURCE:(ARG:0):愛情, 1.10
		SOURCE:(ARG:0):苦痛 += 80
	CASE 4
		TIMES SOURCE:(ARG:0):愛情, 1.20
		SOURCE:(ARG:0):苦痛 += 30
	CASEELSE
		SOURCE:(ARG:0):愛情 = SOURCE:(ARG:0):愛情 * ((ABL:(ARG:0):Ａ感 - 5) * 2 + 130) / 100
ENDSELECT

IF PALAM:(ARG:0):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ａ, 0.05
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 3 + 1000
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ａ, 0.20
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 3 / 2 + 300
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ａ, 0.60
	TIMES SOURCE:(ARG:0):苦痛, 1.00
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ａ, 0.85
	TIMES SOURCE:(ARG:0):苦痛, 0.70
ELSE
	TIMES SOURCE:(ARG:0):快Ａ, 1.00
	TIMES SOURCE:(ARG:0):苦痛, 0.50
ENDIF

IF TALENT:(ARG:0):体格 == 体格_子供 && TALENT:(ARG:1):体格 != 体格_子供
	IF TALENT:(ARG:1):体格 == 体格_小柄
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	ELSE
		TIMES SOURCE:(ARG:0):苦痛, 2.50
	ENDIF
ELSEIF TALENT:(ARG:0):体格 == 体格_小柄 && TALENT:(ARG:1):体格 != 体格_小柄 && TALENT:(ARG:1):体格 != 体格_子供
	TIMES SOURCE:(ARG:0):苦痛, 1.50
ENDIF

;竿サイズで痛みと快感の変動
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		TIMES SOURCE:(ARG:0):快Ａ, 0.50
		TIMES SOURCE:(ARG:0):苦痛, 0.50
	CASE -1
		TIMES SOURCE:(ARG:0):快Ａ, 0.75
		TIMES SOURCE:(ARG:0):苦痛, 0.75
	CASE 1
		TIMES SOURCE:(ARG:0):快Ａ, 1.25
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	CASE 2
		TIMES SOURCE:(ARG:0):快Ａ, 1.50
		TIMES SOURCE:(ARG:0):苦痛, 2.00
ENDSELECT

;挿入側のABL性交で痛み軽減　ただし1～3までは痛み増加　4でやっと等倍　100からは減少しない
SELECTCASE ABL:(ARG:1):性交
	CASE 0 TO 100
		SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * (120 - SQRT(100 * ABL:(ARG:1):性交)) / 100
	CASEELSE
		TIMES SOURCE:(ARG:0):苦痛, 0.20
ENDSELECT

IF IS_ANIMAL(ARG:1)
	SOURCE:(ARG:0):苦痛 = ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, SOURCE:(ARG:0):苦痛)
	SOURCE:(ARG:0):快Ａ = ANIMAL_SOURCE_MULTIPLIER(ARG:0, SOURCE:(ARG:0):快Ａ)
	IF TALENT:(ARG:1):動物 == 動物_馬
		EXP:(ARG:0):Ａ拡張経験 += 1
		CALL TIGHTNESS_DECREASE_A(ARG:0, RAND(5, 10))
	ENDIF
ENDIF

IF PALAM:(ARG:0):欲情 < PALAMLV:1
	TIMES SOURCE:(ARG:0):愛情, 0.40
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:3
	TIMES SOURCE:(ARG:0):愛情, 0.70
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:5
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:7
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF


IF ARG:0 != MASTER && ARG:1 == MASTER
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF


IF !IS_EQUIP_PLAYER(ARG:1, 75) && GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_生ハメ依存)
	SOURCE:(ARG:0):歓喜 += 500
ENDIF

CALL VIRGIN_COMMON_A(ARG:0, @"%ANAME(ARG:1)%", GET_SITUATION_BY_TRAIN_MODE())

;V-AのケースはV側で記述してあるため、ここで記載する必要なし
{
	SIF !IS_INSERT_SINGLE(ARG:0, "Ｖ") && 
		GET_SITUATION_BY_TRAIN_MODE() == "調教" && (
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "口交")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "舔舐睪丸")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "乳交")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "Ａ顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "強制口交"))
		)
}
	EXP:(ARG:0):輪姦経験 ++


EXP:(ARG:0):Ａ性交経験 ++

;対象のアナルが緩む(竿のサイズで変動)
;超短小(0～1) 短小(0～2) 普通(1～3) 巨根(2～4) 超巨根(3～4)
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		LOCAL:1 = RAND(0, 2)
	CASE -1
		LOCAL:1 = RAND(0, 3)
	CASE 0
		LOCAL:1 = RAND(1, 4)
	CASE 1
		LOCAL:1 = RAND(2, 5)
	CASE 2
		LOCAL:1 = RAND(3, 5)
ENDSELECT

;★if difference between sizes is big, increase the stretching
SELECTCASE TALENT:(ARG:0):Ａ緊緻度
	CASE IS >= 締まり_ぎちぎち ;unused
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 7.5 = 11
			LOCAL:1 += RAND(5, 11)
			EXP:(ARG:0):Ａ拡張経験 ++
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 5 = 8
			LOCAL:1 += RAND(3, 8)
		ELSEIF GET_PENISSIZE(ARG:1) == 0
			;2 + 3 = 5
			LOCAL:1 += RAND(2, 5)
		ENDIF
	CASE IS >= 締まり_きつきつ ;shut tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 5 = 8.5
			LOCAL:1 += RAND(3, 8)
			EXP:(ARG:0):Ａ拡張経験 ++
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 3 = 6
			LOCAL:1 += RAND(2, 5)
		ENDIF
	CASE IS >= 締まり_きゅっきゅっ ;very tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 1 = 4.5
			LOCAL:1 += RAND(0, 3)
		ELSEIF GET_PENISSIZE(ARG:1) == 1
			;3 + 0.5 = 3.5
			LOCAL:1 += RAND:2
		ENDIF
	CASE IS >= 締まり_名器 ;tight
		IF GET_PENISSIZE(ARG:1) == 2
			;3.5 + 0.5 = 4
			LOCAL:1 += RAND:2
		ENDIF
ENDSELECT

CALL TIGHTNESS_DECREASE_A(ARG:0, LOCAL:1)


;-------------------------------------------------
;Ｕ性交の共通ソース補正(挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_USEX_P(ARG:0, ARG:1)

SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 250)

SELECTCASE ABL:(ARG:1):Ｕ感
	CASE 0
		TIMES SOURCE:(ARG:0):愛情, 0.90
	CASE 1
		TIMES SOURCE:(ARG:0):愛情, 0.95
	CASE 2
		TIMES SOURCE:(ARG:0):愛情, 1.00
	CASE 3
		TIMES SOURCE:(ARG:0):愛情, 1.05
	CASE 4
		TIMES SOURCE:(ARG:0):愛情, 1.10
	CASEELSE
		SOURCE:(ARG:0):愛情 = SOURCE:(ARG:0):愛情 * MIN((ABL:(ARG:1):Ｖ感 - 5) * 1 + 115, 300) / 100
ENDSELECT

IF PALAM:(ARG:1):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ｐ, 0.30
	TIMES SOURCE:(ARG:0):愛情, 0.50
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ｐ, 0.60
	TIMES SOURCE:(ARG:0):愛情, 0.80
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ｐ, 0.80
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:1):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ｐ, 0.90
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):快Ｐ, 1.00
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF PALAM:(ARG:0):欲情 < PALAMLV:1
	TIMES SOURCE:(ARG:0):愛情, 0.40
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:3
	TIMES SOURCE:(ARG:0):愛情, 0.70
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:5
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:7
	TIMES SOURCE:(ARG:0):愛情, 1.10
ELSE
	TIMES SOURCE:(ARG:0):愛情, 1.20
ENDIF

IF TALENT:(ARG:0):童貞
	TIMES SOURCE:(ARG:0):愛情, 2.50
ENDIF

IF ARG:0 != MASTER && ARG:1 == MASTER
	IF TALENT:(ARG:0):恋慕 || TALENT:(ARG:0):親友
		IF TALENT:(ARG:0):貞操観念
			TIMES SOURCE:(ARG:0):愛情, 1.50
		ELSEIF TALENT:(ARG:0):不在乎貞操
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ENDIF
	ELSE
		IF TALENT:(ARG:0):貞操観念
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 2500
			ELSE
				SOURCE:(ARG:0):反感 = 500
			ENDIF
			TIMES SOURCE:(ARG:0):愛情, 0.60
		ELSEIF !TALENT:(ARG:0):不在乎貞操
			IF TALENT:(ARG:0):童貞
				SOURCE:(ARG:0):反感 = 500
			ENDIF
		ENDIF
		IF TALENT:(ARG:0):恋人
			TIMES SOURCE:(ARG:0):反感, 0.10
		ENDIF
	ENDIF

	;好感度と従属度と支配度のうち大きいほうが影響
	LOCAL:0 = MAX(CFLAG:(ARG:0):2, CFLAG:(ARG:0):4, CFLAG:(ARG:0):5)
	IF LOCAL:0 < 100
		TIMES SOURCE:(ARG:0):反感, 1.00
	ELSEIF LOCAL:0 < 300
		TIMES SOURCE:(ARG:0):反感, 0.90
	ELSEIF LOCAL:0 < 500
		TIMES SOURCE:(ARG:0):反感, 0.80
	ELSEIF LOCAL:0 < 800
		TIMES SOURCE:(ARG:0):反感, 0.40
	ELSEIF LOCAL:0 < 1500
		TIMES SOURCE:(ARG:0):反感, 0.15
	ELSE
		SOURCE:(ARG:0):反感 = SOURCE:(ARG:0):反感 / ((LOCAL:0 - 1500) / 50 + 10)
	ENDIF
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF

CALL DOUTEI_COMMON(ARG:0, @"%ANAME(ARG:1)%的尿道", GET_SITUATION_BY_TRAIN_MODE())

EXP:(ARG:0):Ｕ挿入経験 ++

IF TALENT:(ARG:0):童貞 && HAS_PENIS(ARG:0)
	IF ARG:1 == MASTER
		;童貞喪失フラグ(主人との性交)
		TCVAR:(ARG:0):14 = 1
	ELSE
		;童貞喪失フラグ(主人以外との性交)
		TCVAR:(ARG:0):14 = 3
	ENDIF
ENDIF


;-------------------------------------------------
;Ｕ性交の共通ソース補正(被挿入側)  ARG:0は対象の、ARG:1は相手のキャラ番号
;-------------------------------------------------
@COM_COMMON_USEX_U(ARG:0, ARG:1)
SOURCE:(ARG:0):奉仕 = SERVE_SEX(ARG:0, 150)

SELECTCASE ABL:(ARG:0):Ｕ感
	CASE 0
		TIMES SOURCE:(ARG:0):愛情, 0.20
		SOURCE:(ARG:0):苦痛 += 1500
	CASE 1
		TIMES SOURCE:(ARG:0):愛情, 0.40
		SOURCE:(ARG:0):苦痛 += 500
	CASE 2
		TIMES SOURCE:(ARG:0):愛情, 0.70
		SOURCE:(ARG:0):苦痛 += 200
	CASE 3
		TIMES SOURCE:(ARG:0):愛情, 0.90
		SOURCE:(ARG:0):苦痛 += 80
	CASE 4
		TIMES SOURCE:(ARG:0):愛情, 1.00
		SOURCE:(ARG:0):苦痛 += 30
	CASEELSE
		SOURCE:(ARG:0):愛情 = SOURCE:(ARG:0):愛情 * ((ABL:(ARG:0):Ｕ感 - 5) * 2 + 110) / 100
ENDSELECT

IF PALAM:(ARG:0):潤滑 < PALAMLV:1
	TIMES SOURCE:(ARG:0):快Ｕ, 0.05
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 3 + 1000
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:3
	TIMES SOURCE:(ARG:0):快Ｕ, 0.20
	SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * 3 / 2 + 300
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:5
	TIMES SOURCE:(ARG:0):快Ｕ, 0.60
	TIMES SOURCE:(ARG:0):苦痛, 1.00
ELSEIF PALAM:(ARG:0):潤滑 < PALAMLV:7
	TIMES SOURCE:(ARG:0):快Ｕ, 0.85
	TIMES SOURCE:(ARG:0):苦痛, 0.70
ELSE
	TIMES SOURCE:(ARG:0):快Ｕ, 1.00
	TIMES SOURCE:(ARG:0):苦痛, 0.50
ENDIF

IF TALENT:(ARG:0):体格 == 体格_子供 && TALENT:(ARG:1):体格 != 体格_子供
	IF TALENT:(ARG:1):体格 == 体格_小柄
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	ELSE
		TIMES SOURCE:(ARG:0):苦痛, 2.50
	ENDIF
ELSEIF TALENT:(ARG:0):体格 == 体格_小柄 && TALENT:(ARG:1):体格 != 体格_小柄 && TALENT:(ARG:1):体格 != 体格_子供
	TIMES SOURCE:(ARG:0):苦痛, 1.50
ENDIF

;竿サイズで痛みと快感の変動
SELECTCASE GET_PENISSIZE(ARG:1)
	CASE -2
		TIMES SOURCE:(ARG:0):快Ｕ, 0.50
		TIMES SOURCE:(ARG:0):苦痛, 0.50
	CASE -1
		TIMES SOURCE:(ARG:0):快Ｕ, 0.75
		TIMES SOURCE:(ARG:0):苦痛, 0.75
	CASE 1
		TIMES SOURCE:(ARG:0):快Ｕ, 1.25
		TIMES SOURCE:(ARG:0):苦痛, 1.50
	CASE 2
		TIMES SOURCE:(ARG:0):快Ｕ, 1.50
		TIMES SOURCE:(ARG:0):苦痛, 2.00
ENDSELECT

;挿入側のABL性交で痛み軽減　ただし1～3までは痛み増加　4でやっと等倍　100からは減少しない
SELECTCASE ABL:(ARG:1):性交
	CASE 0 TO 100
		SOURCE:(ARG:0):苦痛 = SOURCE:(ARG:0):苦痛 * (120 - SQRT(100 * ABL:(ARG:1):性交)) / 100
	CASEELSE
		TIMES SOURCE:(ARG:0):苦痛, 0.20
ENDSELECT

IF IS_ANIMAL(ARG:1)
	SOURCE:(ARG:0):苦痛 = ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, SOURCE:(ARG:0):苦痛)
	SOURCE:(ARG:0):快Ｕ = ANIMAL_SOURCE_MULTIPLIER(ARG:0, SOURCE:(ARG:0):快Ｕ)
ENDIF

IF PALAM:(ARG:0):欲情 < PALAMLV:1
	TIMES SOURCE:(ARG:0):愛情, 0.30
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:3
	TIMES SOURCE:(ARG:0):愛情, 0.50
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:5
	TIMES SOURCE:(ARG:0):愛情, 0.80
ELSEIF PALAM:(ARG:0):欲情 < PALAMLV:7
	TIMES SOURCE:(ARG:0):愛情, 1.00
ELSE
	TIMES SOURCE:(ARG:0):愛情, 1.10
ENDIF


IF ARG:0 != MASTER && ARG:1 == MASTER
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 0.8
ELSE 
	SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_浮気癖)
		TIMES LOCAL:0, 1.1
ENDIF


IF !IS_EQUIP_PLAYER(ARG:1, 75) && GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_生ハメ依存)
	SOURCE:(ARG:0):歓喜 += 500
ENDIF

{
	SIF !IS_INSERT_SINGLE(ARG:0, "Ｖ") && 
		GET_SITUATION_BY_TRAIN_MODE() == "調教" && (
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "口交")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "舔舐睪丸")) ||
		IS_EQUIP_PLAYER(ARG:0, GETNUM(TRAINNAME, "乳交")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "Ａ顔面騎乗")) ||
		IS_EQUIP_TARGET(ARG:0, GETNUM(TRAINNAME, "強制口交"))
		)
}
	EXP:(ARG:0):輪姦経験 ++


EXP:(ARG:0):Ｕ性交経験 ++

;------------------
;動物キャラに何かされるor何かするときの、獣姦経験による補正計算
;ARG:0がキャラ、ARG:1が計算したい数値
;-----------------
@ANIMAL_SOURCE_MULTIPLIER(ARG:0, ARG:1)
#FUNCTION
SELECTCASE EXP:(ARG:0):獣姦経験
	CASE IS < 50
		TIMES ARG:1, 0.50
	CASE IS < 100
		TIMES ARG:1, 0.70
	CASE IS < 150
		TIMES ARG:1, 1.00
	CASE IS < 200
		TIMES ARG:1, 1.10
	CASE IS < 300
		TIMES ARG:1, 1.20
	CASEELSE
		TIMES ARG:1, 1.30
ENDSELECT
SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_雌犬)
	TIMES ARG:1, 1.10
RETURNF ARG:1

;------------------
;動物キャラに何かされるor何かするときの、獣姦経験による逆補正計算
;ARG:0がキャラ、ARG:1が計算したい数値
;-----------------
@ANIMAL_SOURCE_MULTIPLIER_REVERSED(ARG:0, ARG:1)
#FUNCTION
SELECTCASE EXP:(ARG:0):獣姦経験
	CASE IS < 50
		TIMES ARG:1, 1.50
	CASE IS < 100
		TIMES ARG:1, 1.25
	CASE IS < 150
		TIMES ARG:1, 1.00
	CASE IS < 200
		TIMES ARG:1, 0.90
	CASE IS < 300
		TIMES ARG:1, 0.80
	CASEELSE
		TIMES ARG:1, 0.70
ENDSELECT
SIF GETBIT(TALENT:(ARG:0):淫乱系, 素質_淫乱_雌犬)
	TIMES ARG:1, 0.8
RETURNF ARG:1
